{"version":3,"names":["_workletStackDetails","Map","registerWorkletStackDetails","hash","stackDetails","set","getBundleOffset","error","_error$stack","_error$stack$split","frame","stack","split","parsedFrame","exec","_parsedFrame","_slicedToArray2","default","file","line","col","Number","processStack","workletStackEntries","match","result","forEach","_match$split$map","map","_match$split$map2","origLine","origCol","errorDetails","get","_errorDetails","lineOffset","colOffset","_getBundleOffset","_getBundleOffset2","bundleFile","bundleLine","bundleCol","replace","reportFatalErrorOnJS","_ref","message","Error","undefined","name","jsEngine","global","ErrorUtils","reportFatalError"],"sources":["errors.ts"],"sourcesContent":["type StackDetails = [Error, number, number];\n\nconst _workletStackDetails = new Map<number, StackDetails>();\n\nexport function registerWorkletStackDetails(\n  hash: number,\n  stackDetails: StackDetails\n) {\n  _workletStackDetails.set(hash, stackDetails);\n}\n\nfunction getBundleOffset(error: Error): [string, number, number] {\n  const frame = error.stack?.split('\\n')?.[0];\n  if (frame) {\n    const parsedFrame = /@([^@]+):(\\d+):(\\d+)/.exec(frame);\n    if (parsedFrame) {\n      const [, file, line, col] = parsedFrame;\n      return [file, Number(line), Number(col)];\n    }\n  }\n  return ['unknown', 0, 0];\n}\n\nfunction processStack(stack: string): string {\n  const workletStackEntries = stack.match(/worklet_(\\d+):(\\d+):(\\d+)/g);\n  let result = stack;\n  workletStackEntries?.forEach((match) => {\n    const [, hash, origLine, origCol] = match.split(/:|_/).map(Number);\n    const errorDetails = _workletStackDetails.get(hash);\n    if (!errorDetails) {\n      return;\n    }\n    const [error, lineOffset, colOffset] = errorDetails;\n    const [bundleFile, bundleLine, bundleCol] = getBundleOffset(error);\n    const line = origLine + bundleLine + lineOffset;\n    const col = origCol + bundleCol + colOffset;\n\n    result = result.replace(match, `${bundleFile}:${line}:${col}`);\n  });\n  return result;\n}\n\nexport function reportFatalErrorOnJS({\n  message,\n  stack,\n}: {\n  message: string;\n  stack?: string;\n}) {\n  const error = new Error();\n  error.message = message;\n  error.stack = stack ? processStack(stack) : undefined;\n  error.name = 'ReanimatedError';\n  // @ts-ignore React Native's ErrorUtils implementation extends the Error type with jsEngine field\n  error.jsEngine = 'reanimated';\n  // @ts-ignore the reportFatalError method is an internal method of ErrorUtils not exposed in the type definitions\n  global.ErrorUtils.reportFatalError(error);\n}\n"],"mappings":";;;;;;;AAEA,IAAMA,oBAAoB,GAAG,IAAIC,GAAG,EAAwB;AAErD,SAASC,2BAA2BA,CACzCC,IAAY,EACZC,YAA0B,EAC1B;EACAJ,oBAAoB,CAACK,GAAG,CAACF,IAAI,EAAEC,YAAY,CAAC;AAC9C;AAEA,SAASE,eAAeA,CAACC,KAAY,EAA4B;EAAA,IAAAC,YAAA,EAAAC,kBAAA;EAC/D,IAAMC,KAAK,IAAAF,YAAA,GAAGD,KAAK,CAACI,KAAK,cAAAH,YAAA,wBAAAC,kBAAA,GAAXD,YAAA,CAAaI,KAAK,CAAC,IAAI,CAAC,cAAAH,kBAAA,uBAAxBA,kBAAA,CAA2B,CAAC,CAAC;EAC3C,IAAIC,KAAK,EAAE;IACT,IAAMG,WAAW,GAAG,sBAAsB,CAACC,IAAI,CAACJ,KAAK,CAAC;IACtD,IAAIG,WAAW,EAAE;MACf,IAAAE,YAAA,OAAAC,eAAA,CAAAC,OAAA,EAA4BJ,WAAW;QAA9BK,IAAI,GAAAH,YAAA;QAAEI,IAAI,GAAAJ,YAAA;QAAEK,GAAG,GAAAL,YAAA;MACxB,OAAO,CAACG,IAAI,EAAEG,MAAM,CAACF,IAAI,CAAC,EAAEE,MAAM,CAACD,GAAG,CAAC,CAAC;IAC1C;EACF;EACA,OAAO,CAAC,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC;AAC1B;AAEA,SAASE,YAAYA,CAACX,KAAa,EAAU;EAC3C,IAAMY,mBAAmB,GAAGZ,KAAK,CAACa,KAAK,CAAC,4BAA4B,CAAC;EACrE,IAAIC,MAAM,GAAGd,KAAK;EAClBY,mBAAmB,aAAnBA,mBAAmB,uBAAnBA,mBAAmB,CAAEG,OAAO,CAAE,UAAAF,KAAK,EAAK;IACtC,IAAAG,gBAAA,GAAoCH,KAAK,CAACZ,KAAK,CAAC,KAAK,CAAC,CAACgB,GAAG,CAACP,MAAM,CAAC;MAAAQ,iBAAA,OAAAb,eAAA,CAAAC,OAAA,EAAAU,gBAAA;MAAzDxB,IAAI,GAAA0B,iBAAA;MAAEC,QAAQ,GAAAD,iBAAA;MAAEE,OAAO,GAAAF,iBAAA;IAChC,IAAMG,YAAY,GAAGhC,oBAAoB,CAACiC,GAAG,CAAC9B,IAAI,CAAC;IACnD,IAAI,CAAC6B,YAAY,EAAE;MACjB;IACF;IACA,IAAAE,aAAA,OAAAlB,eAAA,CAAAC,OAAA,EAAuCe,YAAY;MAA5CzB,KAAK,GAAA2B,aAAA;MAAEC,UAAU,GAAAD,aAAA;MAAEE,SAAS,GAAAF,aAAA;IACnC,IAAAG,gBAAA,GAA4C/B,eAAe,CAACC,KAAK,CAAC;MAAA+B,iBAAA,OAAAtB,eAAA,CAAAC,OAAA,EAAAoB,gBAAA;MAA3DE,UAAU,GAAAD,iBAAA;MAAEE,UAAU,GAAAF,iBAAA;MAAEG,SAAS,GAAAH,iBAAA;IACxC,IAAMnB,IAAI,GAAGW,QAAQ,GAAGU,UAAU,GAAGL,UAAU;IAC/C,IAAMf,GAAG,GAAGW,OAAO,GAAGU,SAAS,GAAGL,SAAS;IAE3CX,MAAM,GAAGA,MAAM,CAACiB,OAAO,CAAClB,KAAK,EAAG,GAAEe,UAAW,IAAGpB,IAAK,IAAGC,GAAI,EAAC,CAAC;EAChE,CAAC,CAAC;EACF,OAAOK,MAAM;AACf;AAEO,SAASkB,oBAAoBA,CAAAC,IAAA,EAMjC;EAAA,IALDC,OAAO,GAKRD,IAAA,CALCC,OAAO;IACPlC,KAAA,GAIDiC,IAAA,CAJCjC,KAAA;EAKA,IAAMJ,KAAK,GAAG,IAAIuC,KAAK,EAAE;EACzBvC,KAAK,CAACsC,OAAO,GAAGA,OAAO;EACvBtC,KAAK,CAACI,KAAK,GAAGA,KAAK,GAAGW,YAAY,CAACX,KAAK,CAAC,GAAGoC,SAAS;EACrDxC,KAAK,CAACyC,IAAI,GAAG,iBAAiB;EAE9BzC,KAAK,CAAC0C,QAAQ,GAAG,YAAY;EAE7BC,MAAM,CAACC,UAAU,CAACC,gBAAgB,CAAC7C,KAAK,CAAC;AAC3C"}