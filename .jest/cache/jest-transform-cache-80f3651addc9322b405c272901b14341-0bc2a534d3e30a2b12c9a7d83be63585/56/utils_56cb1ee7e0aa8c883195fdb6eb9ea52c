0dd844566edee1968b796abf93990e48
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.areDependenciesEqual = areDependenciesEqual;
exports.buildDependencies = buildDependencies;
exports.buildWorkletsHash = buildWorkletsHash;
exports.hasColorProps = hasColorProps;
exports.isAnimated = isAnimated;
exports.parseColors = parseColors;
exports.shallowEqual = shallowEqual;
exports.validateAnimatedStyles = exports.useHandler = exports.useEvent = void 0;
var _react = require("react");
var _Colors = require("../Colors");
var _core = require("../core");
var _PlatformChecker = require("../PlatformChecker");
var _UpdateProps = require("../UpdateProps");
var _WorkletEventHandler = _interopRequireDefault(require("../WorkletEventHandler"));
var useEvent = function useEvent(handler) {
  var eventNames = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
  var rebuild = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  var initRef = (0, _react.useRef)(null);
  if (initRef.current === null) {
    initRef.current = new _WorkletEventHandler.default(handler, eventNames);
  } else if (rebuild) {
    initRef.current.updateWorklet(handler);
  }
  return initRef;
};
exports.useEvent = useEvent;
var useHandler = function useHandler(handlers, dependencies) {
  var initRef = (0, _react.useRef)(null);
  if (initRef.current === null) {
    initRef.current = {
      context: (0, _core.makeRemote)({}),
      savedDependencies: []
    };
  }
  (0, _react.useEffect)(function () {
    return function () {
      initRef.current = null;
    };
  }, []);
  var _initRef$current = initRef.current,
    context = _initRef$current.context,
    savedDependencies = _initRef$current.savedDependencies;
  dependencies = buildDependencies(dependencies, handlers);
  var doDependenciesDiffer = !areDependenciesEqual(dependencies, savedDependencies);
  initRef.current.savedDependencies = dependencies;
  var useWeb = (0, _PlatformChecker.isWeb)() || (0, _PlatformChecker.isJest)();
  return {
    context: context,
    doDependenciesDiffer: doDependenciesDiffer,
    useWeb: useWeb
  };
};
exports.useHandler = useHandler;
function buildWorkletsHash(handlers) {
  return Object.values(handlers).reduce(function (acc, worklet) {
    return acc + worklet.__workletHash.toString();
  }, '');
}
function buildDependencies(dependencies, handlers) {
  var handlersList = Object.values(handlers).filter(function (handler) {
    return handler !== undefined;
  });
  if (!dependencies) {
    dependencies = handlersList.map(function (handler) {
      return {
        workletHash: handler.__workletHash,
        closure: handler._closure
      };
    });
  } else {
    dependencies.push(buildWorkletsHash(handlersList));
  }
  return dependencies;
}
function areDependenciesEqual(nextDeps, prevDeps) {
  function is(x, y) {
    return x === y && (x !== 0 || 1 / x === 1 / y) || x !== x && y !== y;
  }
  var objectIs = typeof Object.is === 'function' ? Object.is : is;
  function areHookInputsEqual(nextDeps, prevDeps) {
    if (!nextDeps || !prevDeps || prevDeps.length !== nextDeps.length) {
      return false;
    }
    for (var i = 0; i < prevDeps.length; ++i) {
      if (!objectIs(nextDeps[i], prevDeps[i])) {
        return false;
      }
    }
    return true;
  }
  return areHookInputsEqual(nextDeps, prevDeps);
}
function hasColorProps(updates) {
  var colorPropsSet = new Set(_UpdateProps.colorProps);
  for (var key in updates) {
    if (colorPropsSet.has(key)) {
      return true;
    }
  }
  return false;
}
function parseColors(updates) {
  'worklet';

  for (var key in updates) {
    if (_UpdateProps.colorProps.indexOf(key) !== -1) {
      var processedColor = (0, _Colors.processColor)(updates[key]);
      if (processedColor !== undefined) {
        updates[key] = processedColor;
      }
    }
  }
}
function isAnimated(prop) {
  'worklet';

  if (Array.isArray(prop)) {
    return prop.some(isAnimated);
  } else if (typeof prop === 'object' && prop !== null) {
    if (prop.onFrame !== undefined) {
      return true;
    } else {
      return Object.values(prop).some(isAnimated);
    }
  }
  return false;
}
function shallowEqual(a, b) {
  'worklet';

  var aKeys = Object.keys(a);
  var bKeys = Object.keys(b);
  if (aKeys.length !== bKeys.length) {
    return false;
  }
  for (var i = 0; i < aKeys.length; i++) {
    if (a[aKeys[i]] !== b[aKeys[i]]) {
      return false;
    }
  }
  return true;
}
var validateAnimatedStyles = function validateAnimatedStyles(styles) {
  'worklet';

  if (typeof styles !== 'object') {
    throw new Error(`useAnimatedStyle has to return an object, found ${typeof styles} instead`);
  } else if (Array.isArray(styles)) {
    throw new Error('useAnimatedStyle has to return an object and cannot return static styles combined with dynamic ones. Please do merging where a component receives props.');
  }
};
exports.validateAnimatedStyles = validateAnimatedStyles;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiX0NvbG9ycyIsIl9jb3JlIiwiX1BsYXRmb3JtQ2hlY2tlciIsIl9VcGRhdGVQcm9wcyIsIl9Xb3JrbGV0RXZlbnRIYW5kbGVyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInVzZUV2ZW50IiwiaGFuZGxlciIsImV2ZW50TmFtZXMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJyZWJ1aWxkIiwiaW5pdFJlZiIsInVzZVJlZiIsImN1cnJlbnQiLCJXb3JrbGV0RXZlbnRIYW5kbGVyIiwidXBkYXRlV29ya2xldCIsImV4cG9ydHMiLCJ1c2VIYW5kbGVyIiwiaGFuZGxlcnMiLCJkZXBlbmRlbmNpZXMiLCJjb250ZXh0IiwibWFrZVJlbW90ZSIsInNhdmVkRGVwZW5kZW5jaWVzIiwidXNlRWZmZWN0IiwiX2luaXRSZWYkY3VycmVudCIsImJ1aWxkRGVwZW5kZW5jaWVzIiwiZG9EZXBlbmRlbmNpZXNEaWZmZXIiLCJhcmVEZXBlbmRlbmNpZXNFcXVhbCIsInVzZVdlYiIsImlzV2ViIiwiaXNKZXN0IiwiYnVpbGRXb3JrbGV0c0hhc2giLCJPYmplY3QiLCJ2YWx1ZXMiLCJyZWR1Y2UiLCJhY2MiLCJ3b3JrbGV0IiwiX193b3JrbGV0SGFzaCIsInRvU3RyaW5nIiwiaGFuZGxlcnNMaXN0IiwiZmlsdGVyIiwibWFwIiwid29ya2xldEhhc2giLCJjbG9zdXJlIiwiX2Nsb3N1cmUiLCJwdXNoIiwibmV4dERlcHMiLCJwcmV2RGVwcyIsImlzIiwieCIsInkiLCJvYmplY3RJcyIsImFyZUhvb2tJbnB1dHNFcXVhbCIsImkiLCJoYXNDb2xvclByb3BzIiwidXBkYXRlcyIsImNvbG9yUHJvcHNTZXQiLCJTZXQiLCJjb2xvclByb3BzIiwia2V5IiwiaGFzIiwicGFyc2VDb2xvcnMiLCJpbmRleE9mIiwicHJvY2Vzc2VkQ29sb3IiLCJwcm9jZXNzQ29sb3IiLCJpc0FuaW1hdGVkIiwicHJvcCIsIkFycmF5IiwiaXNBcnJheSIsInNvbWUiLCJvbkZyYW1lIiwic2hhbGxvd0VxdWFsIiwiYSIsImIiLCJhS2V5cyIsImtleXMiLCJiS2V5cyIsInZhbGlkYXRlQW5pbWF0ZWRTdHlsZXMiLCJzdHlsZXMiLCJFcnJvciJdLCJzb3VyY2VzIjpbInV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTXV0YWJsZVJlZk9iamVjdCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgcHJvY2Vzc0NvbG9yIH0gZnJvbSAnLi4vQ29sb3JzJztcbmltcG9ydCB0eXBlIHtcbiAgQW5pbWF0ZWRTdHlsZSxcbiAgQ29udGV4dCxcbiAgTmF0aXZlRXZlbnQsXG4gIE5lc3RlZE9iamVjdFZhbHVlcyxcbiAgV29ya2xldEZ1bmN0aW9uLFxuICBBbmltYXRpb25PYmplY3QsXG59IGZyb20gJy4uL2NvbW1vblR5cGVzJztcbmltcG9ydCB7IG1ha2VSZW1vdGUgfSBmcm9tICcuLi9jb3JlJztcbmltcG9ydCB7IGlzV2ViLCBpc0plc3QgfSBmcm9tICcuLi9QbGF0Zm9ybUNoZWNrZXInO1xuaW1wb3J0IHsgY29sb3JQcm9wcyB9IGZyb20gJy4uL1VwZGF0ZVByb3BzJztcbmltcG9ydCBXb3JrbGV0RXZlbnRIYW5kbGVyIGZyb20gJy4uL1dvcmtsZXRFdmVudEhhbmRsZXInO1xuaW1wb3J0IHR5cGUgeyBDb250ZXh0V2l0aERlcGVuZGVuY2llcywgRGVwZW5kZW5jeUxpc3QgfSBmcm9tICcuL2NvbW1vblR5cGVzJztcbmltcG9ydCB0eXBlIHsgTmF0aXZlU3ludGhldGljRXZlbnQgfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW50ZXJmYWNlIEhhbmRsZXI8VCwgVENvbnRleHQgZXh0ZW5kcyBDb250ZXh0PiBleHRlbmRzIFdvcmtsZXRGdW5jdGlvbiB7XG4gIChldmVudDogVCwgY29udGV4dDogVENvbnRleHQpOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSGFuZGxlcnM8VCwgVENvbnRleHQgZXh0ZW5kcyBDb250ZXh0PiB7XG4gIFtrZXk6IHN0cmluZ106IEhhbmRsZXI8VCwgVENvbnRleHQ+IHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZUhhbmRsZXJDb250ZXh0PFRDb250ZXh0IGV4dGVuZHMgQ29udGV4dD4ge1xuICBjb250ZXh0OiBUQ29udGV4dDtcbiAgZG9EZXBlbmRlbmNpZXNEaWZmZXI6IGJvb2xlYW47XG4gIHVzZVdlYjogYm9vbGVhbjtcbn1cblxuLy8gVE9ETyBUWVBFU0NSSVBUIFRoaXMgaXMgYSB0ZW1wb3JhcnkgdHlwZSB0byBnZXQgcmlkIG9mIC5kLnRzIGZpbGUuXG50eXBlIHVzZUV2ZW50VHlwZSA9IDxUIGV4dGVuZHMgb2JqZWN0PihcbiAgaGFuZGxlcjogKGU6IFQpID0+IHZvaWQsXG4gIGV2ZW50TmFtZXM/OiBzdHJpbmdbXSxcbiAgcmVidWlsZD86IGJvb2xlYW5cbikgPT4gKGU6IE5hdGl2ZVN5bnRoZXRpY0V2ZW50PFQ+KSA9PiB2b2lkO1xuXG5leHBvcnQgY29uc3QgdXNlRXZlbnQgPSBmdW5jdGlvbiA8VCBleHRlbmRzIE5hdGl2ZUV2ZW50PFQ+PihcbiAgaGFuZGxlcjogKGV2ZW50OiBUKSA9PiB2b2lkLFxuICBldmVudE5hbWVzOiBzdHJpbmdbXSA9IFtdLFxuICByZWJ1aWxkID0gZmFsc2Vcbik6IE11dGFibGVSZWZPYmplY3Q8V29ya2xldEV2ZW50SGFuZGxlcjxUPiB8IG51bGw+IHtcbiAgY29uc3QgaW5pdFJlZiA9IHVzZVJlZjxXb3JrbGV0RXZlbnRIYW5kbGVyPFQ+IHwgbnVsbD4obnVsbCk7XG4gIGlmIChpbml0UmVmLmN1cnJlbnQgPT09IG51bGwpIHtcbiAgICBpbml0UmVmLmN1cnJlbnQgPSBuZXcgV29ya2xldEV2ZW50SGFuZGxlcihoYW5kbGVyLCBldmVudE5hbWVzKTtcbiAgfSBlbHNlIGlmIChyZWJ1aWxkKSB7XG4gICAgaW5pdFJlZi5jdXJyZW50LnVwZGF0ZVdvcmtsZXQoaGFuZGxlcik7XG4gIH1cblxuICByZXR1cm4gaW5pdFJlZjtcbiAgLy8gVE9ETyBUWVBFU0NSSVBUIFRoaXMgY2FzdCBpcyB0byBnZXQgcmlkIG9mIC5kLnRzIGZpbGUuXG59IGFzIHVua25vd24gYXMgdXNlRXZlbnRUeXBlO1xuXG4vLyBUT0RPIFRZUEVTQ1JJUFQgVGhpcyBpcyBhIHRlbXBvcmFyeSB0eXBlIHRvIGdldCByaWQgb2YgLmQudHMgZmlsZS5cbnR5cGUgdXNlSGFuZGxlclR5cGUgPSA8VCwgVENvbnRleHQgZXh0ZW5kcyBDb250ZXh0ID0gUmVjb3JkPHN0cmluZywgbmV2ZXI+PihcbiAgaGFuZGxlcnM6IEhhbmRsZXJzPFQsIFRDb250ZXh0PixcbiAgZGVwcz86IERlcGVuZGVuY3lMaXN0XG4pID0+IHsgY29udGV4dDogVENvbnRleHQ7IGRvRGVwZW5kZW5jaWVzRGlmZmVyOiBib29sZWFuOyB1c2VXZWI6IGJvb2xlYW4gfTtcblxuZXhwb3J0IGNvbnN0IHVzZUhhbmRsZXIgPSBmdW5jdGlvbiA8VCwgVENvbnRleHQgZXh0ZW5kcyBDb250ZXh0PihcbiAgaGFuZGxlcnM6IEhhbmRsZXJzPFQsIFRDb250ZXh0PixcbiAgZGVwZW5kZW5jaWVzPzogRGVwZW5kZW5jeUxpc3Rcbik6IFVzZUhhbmRsZXJDb250ZXh0PFRDb250ZXh0PiB7XG4gIGNvbnN0IGluaXRSZWYgPSB1c2VSZWY8Q29udGV4dFdpdGhEZXBlbmRlbmNpZXM8VENvbnRleHQ+IHwgbnVsbD4obnVsbCk7XG4gIGlmIChpbml0UmVmLmN1cnJlbnQgPT09IG51bGwpIHtcbiAgICBpbml0UmVmLmN1cnJlbnQgPSB7XG4gICAgICBjb250ZXh0OiBtYWtlUmVtb3RlPFRDb250ZXh0Pih7fSBhcyBUQ29udGV4dCksXG4gICAgICBzYXZlZERlcGVuZGVuY2llczogW10sXG4gICAgfTtcbiAgfVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGluaXRSZWYuY3VycmVudCA9IG51bGw7XG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IHsgY29udGV4dCwgc2F2ZWREZXBlbmRlbmNpZXMgfSA9IGluaXRSZWYuY3VycmVudDtcblxuICBkZXBlbmRlbmNpZXMgPSBidWlsZERlcGVuZGVuY2llcyhkZXBlbmRlbmNpZXMsIGhhbmRsZXJzKTtcblxuICBjb25zdCBkb0RlcGVuZGVuY2llc0RpZmZlciA9ICFhcmVEZXBlbmRlbmNpZXNFcXVhbChcbiAgICBkZXBlbmRlbmNpZXMsXG4gICAgc2F2ZWREZXBlbmRlbmNpZXNcbiAgKTtcbiAgaW5pdFJlZi5jdXJyZW50LnNhdmVkRGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzO1xuICBjb25zdCB1c2VXZWIgPSBpc1dlYigpIHx8IGlzSmVzdCgpO1xuXG4gIHJldHVybiB7IGNvbnRleHQsIGRvRGVwZW5kZW5jaWVzRGlmZmVyLCB1c2VXZWIgfTtcbiAgLy8gVE9ETyBUWVBFU0NSSVBUIFRoaXMgdGVtcG9yYXJ5IGNhc3QgaXMgdG8gZ2V0IHJpZCBvZiAuZC50cyBmaWxlLlxufSBhcyB1c2VIYW5kbGVyVHlwZTtcblxuLy8gYnVpbGRzIG9uZSBiaWcgaGFzaCBmcm9tIG11bHRpcGxlIHdvcmtsZXRzJyBoYXNoZXNcbmV4cG9ydCBmdW5jdGlvbiBidWlsZFdvcmtsZXRzSGFzaChcbiAgaGFuZGxlcnM6IFJlY29yZDxzdHJpbmcsIFdvcmtsZXRGdW5jdGlvbj4gfCBBcnJheTxXb3JrbGV0RnVuY3Rpb24+XG4pOiBzdHJpbmcge1xuICByZXR1cm4gT2JqZWN0LnZhbHVlcyhoYW5kbGVycykucmVkdWNlKFxuICAgIChhY2M6IHN0cmluZywgd29ya2xldDogV29ya2xldEZ1bmN0aW9uKSA9PlxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb25cbiAgICAgIGFjYyArIHdvcmtsZXQuX193b3JrbGV0SGFzaCEudG9TdHJpbmcoKSxcbiAgICAnJ1xuICApO1xufVxuXG4vLyBidWlsZHMgZGVwZW5kZW5jaWVzIGFycmF5IGZvciBnZXN0dXJlIGhhbmRsZXJzXG5leHBvcnQgZnVuY3Rpb24gYnVpbGREZXBlbmRlbmNpZXMoXG4gIGRlcGVuZGVuY2llczogRGVwZW5kZW5jeUxpc3QsXG4gIGhhbmRsZXJzOiBSZWNvcmQ8c3RyaW5nLCBXb3JrbGV0RnVuY3Rpb24gfCB1bmRlZmluZWQ+XG4pOiBBcnJheTx1bmtub3duPiB7XG4gIGNvbnN0IGhhbmRsZXJzTGlzdDogV29ya2xldEZ1bmN0aW9uW10gPSBPYmplY3QudmFsdWVzKGhhbmRsZXJzKS5maWx0ZXIoXG4gICAgKGhhbmRsZXIpID0+IGhhbmRsZXIgIT09IHVuZGVmaW5lZFxuICApIGFzIFdvcmtsZXRGdW5jdGlvbltdO1xuICBpZiAoIWRlcGVuZGVuY2llcykge1xuICAgIGRlcGVuZGVuY2llcyA9IGhhbmRsZXJzTGlzdC5tYXAoKGhhbmRsZXIpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHdvcmtsZXRIYXNoOiBoYW5kbGVyLl9fd29ya2xldEhhc2gsXG4gICAgICAgIGNsb3N1cmU6IGhhbmRsZXIuX2Nsb3N1cmUsXG4gICAgICB9O1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGRlcGVuZGVuY2llcy5wdXNoKGJ1aWxkV29ya2xldHNIYXNoKGhhbmRsZXJzTGlzdCkpO1xuICB9XG5cbiAgcmV0dXJuIGRlcGVuZGVuY2llcztcbn1cblxuLy8gdGhpcyBpcyBzdXBwb3NlZCB0byB3b3JrIGFzIHVzZUVmZmVjdCBjb21wYXJpc29uXG5leHBvcnQgZnVuY3Rpb24gYXJlRGVwZW5kZW5jaWVzRXF1YWwoXG4gIG5leHREZXBzOiBEZXBlbmRlbmN5TGlzdCxcbiAgcHJldkRlcHM6IERlcGVuZGVuY3lMaXN0XG4pOiBib29sZWFuIHtcbiAgZnVuY3Rpb24gaXMoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1zZWxmLWNvbXBhcmUgKi9cbiAgICByZXR1cm4gKHggPT09IHkgJiYgKHggIT09IDAgfHwgMSAvIHggPT09IDEgLyB5KSkgfHwgKHggIT09IHggJiYgeSAhPT0geSk7XG4gICAgLyogZXNsaW50LWVuYWJsZSBuby1zZWxmLWNvbXBhcmUgKi9cbiAgfVxuICBjb25zdCBvYmplY3RJczogKG5leHREZXBzOiB1bmtub3duLCBwcmV2RGVwczogdW5rbm93bikgPT4gYm9vbGVhbiA9XG4gICAgdHlwZW9mIE9iamVjdC5pcyA9PT0gJ2Z1bmN0aW9uJyA/IE9iamVjdC5pcyA6IGlzO1xuXG4gIGZ1bmN0aW9uIGFyZUhvb2tJbnB1dHNFcXVhbChcbiAgICBuZXh0RGVwczogRGVwZW5kZW5jeUxpc3QsXG4gICAgcHJldkRlcHM6IERlcGVuZGVuY3lMaXN0XG4gICk6IGJvb2xlYW4ge1xuICAgIGlmICghbmV4dERlcHMgfHwgIXByZXZEZXBzIHx8IHByZXZEZXBzLmxlbmd0aCAhPT0gbmV4dERlcHMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJldkRlcHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGlmICghb2JqZWN0SXMobmV4dERlcHNbaV0sIHByZXZEZXBzW2ldKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGFyZUhvb2tJbnB1dHNFcXVhbChuZXh0RGVwcywgcHJldkRlcHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFzQ29sb3JQcm9wcyh1cGRhdGVzOiBBbmltYXRlZFN0eWxlKTogYm9vbGVhbiB7XG4gIGNvbnN0IGNvbG9yUHJvcHNTZXQgPSBuZXcgU2V0KGNvbG9yUHJvcHMpO1xuICBmb3IgKGNvbnN0IGtleSBpbiB1cGRhdGVzKSB7XG4gICAgaWYgKGNvbG9yUHJvcHNTZXQuaGFzKGtleSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUNvbG9ycyh1cGRhdGVzOiBBbmltYXRlZFN0eWxlKTogdm9pZCB7XG4gICd3b3JrbGV0JztcbiAgZm9yIChjb25zdCBrZXkgaW4gdXBkYXRlcykge1xuICAgIGlmIChjb2xvclByb3BzLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgIC8vIHZhbHVlIGNvdWxkIGJlIGFuIGFuaW1hdGlvbiBpbiB3aGljaCBjYXNlIHByb2Nlc3NDb2xvciB3aWxsIHJlY29nbml6ZSBpdCBhbmQgd2lsbCByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAvLyAtPiBpbiBzdWNoIGEgY2FzZSB3ZSBkb24ndCB3YW50IHRvIG92ZXJyaWRlIHN0eWxlIG9mIHRoYXQga2V5XG4gICAgICBjb25zdCBwcm9jZXNzZWRDb2xvciA9IHByb2Nlc3NDb2xvcih1cGRhdGVzW2tleV0pO1xuICAgICAgaWYgKHByb2Nlc3NlZENvbG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBkYXRlc1trZXldID0gcHJvY2Vzc2VkQ29sb3I7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FuaW1hdGVkKHByb3A6IE5lc3RlZE9iamVjdFZhbHVlczxBbmltYXRpb25PYmplY3Q+KTogYm9vbGVhbiB7XG4gICd3b3JrbGV0JztcbiAgaWYgKEFycmF5LmlzQXJyYXkocHJvcCkpIHtcbiAgICByZXR1cm4gcHJvcC5zb21lKGlzQW5pbWF0ZWQpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBwcm9wID09PSAnb2JqZWN0JyAmJiBwcm9wICE9PSBudWxsKSB7XG4gICAgaWYgKHByb3Aub25GcmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMocHJvcCkuc29tZShpc0FuaW1hdGVkKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2hhbGxvd0VxdWFsKGE6IGFueSwgYjogYW55KSB7XG4gICd3b3JrbGV0JztcbiAgY29uc3QgYUtleXMgPSBPYmplY3Qua2V5cyhhKTtcbiAgY29uc3QgYktleXMgPSBPYmplY3Qua2V5cyhiKTtcbiAgaWYgKGFLZXlzLmxlbmd0aCAhPT0gYktleXMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYUtleXMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoYVthS2V5c1tpXV0gIT09IGJbYUtleXNbaV1dKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVBbmltYXRlZFN0eWxlcyA9IChzdHlsZXM6IEFuaW1hdGVkU3R5bGUpOiB2b2lkID0+IHtcbiAgJ3dvcmtsZXQnO1xuICBpZiAodHlwZW9mIHN0eWxlcyAhPT0gJ29iamVjdCcpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICBgdXNlQW5pbWF0ZWRTdHlsZSBoYXMgdG8gcmV0dXJuIGFuIG9iamVjdCwgZm91bmQgJHt0eXBlb2Ygc3R5bGVzfSBpbnN0ZWFkYFxuICAgICk7XG4gIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShzdHlsZXMpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ3VzZUFuaW1hdGVkU3R5bGUgaGFzIHRvIHJldHVybiBhbiBvYmplY3QgYW5kIGNhbm5vdCByZXR1cm4gc3RhdGljIHN0eWxlcyBjb21iaW5lZCB3aXRoIGR5bmFtaWMgb25lcy4gUGxlYXNlIGRvIG1lcmdpbmcgd2hlcmUgYSBjb21wb25lbnQgcmVjZWl2ZXMgcHJvcHMuJ1xuICAgICk7XG4gIH1cbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUNBLElBQUFBLE1BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUQsT0FBQTtBQVNBLElBQUFFLEtBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLGdCQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxZQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxvQkFBQSxHQUFBQyxzQkFBQSxDQUFBTixPQUFBO0FBd0JPLElBQU1PLFFBQVEsR0FBRyxTQUFYQSxRQUFRQSxDQUNuQkMsT0FBMkIsRUFHc0I7RUFBQSxJQUZqREMsVUFBb0IsR0FBQUMsU0FBQSxDQUFBQyxNQUFBLFFBQUFELFNBQUEsUUFBQUUsU0FBQSxHQUFBRixTQUFBLE1BQUcsRUFBRTtFQUFBLElBQ3pCRyxPQUFPLEdBQUFILFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHLEtBQUs7RUFFZixJQUFNSSxPQUFPLEdBQUcsSUFBQUMsYUFBTSxFQUFnQyxJQUFJLENBQUM7RUFDM0QsSUFBSUQsT0FBTyxDQUFDRSxPQUFPLEtBQUssSUFBSSxFQUFFO0lBQzVCRixPQUFPLENBQUNFLE9BQU8sR0FBRyxJQUFJQyw0QkFBbUIsQ0FBQ1QsT0FBTyxFQUFFQyxVQUFVLENBQUM7RUFDaEUsQ0FBQyxNQUFNLElBQUlJLE9BQU8sRUFBRTtJQUNsQkMsT0FBTyxDQUFDRSxPQUFPLENBQUNFLGFBQWEsQ0FBQ1YsT0FBTyxDQUFDO0VBQ3hDO0VBRUEsT0FBT00sT0FBTztBQUVoQixDQUE0QjtBQUFBSyxPQUFBLENBQUFaLFFBQUEsR0FBQUEsUUFBQTtBQVFyQixJQUFNYSxVQUFVLEdBQUcsU0FBYkEsVUFBVUEsQ0FDckJDLFFBQStCLEVBQy9CQyxZQUE2QixFQUNBO0VBQzdCLElBQU1SLE9BQU8sR0FBRyxJQUFBQyxhQUFNLEVBQTJDLElBQUksQ0FBQztFQUN0RSxJQUFJRCxPQUFPLENBQUNFLE9BQU8sS0FBSyxJQUFJLEVBQUU7SUFDNUJGLE9BQU8sQ0FBQ0UsT0FBTyxHQUFHO01BQ2hCTyxPQUFPLEVBQUUsSUFBQUMsZ0JBQVUsRUFBVyxDQUFDLENBQUMsQ0FBYTtNQUM3Q0MsaUJBQWlCLEVBQUU7SUFDckIsQ0FBQztFQUNIO0VBRUEsSUFBQUMsZ0JBQVMsRUFBQyxZQUFNO0lBQ2QsT0FBTyxZQUFNO01BQ1haLE9BQU8sQ0FBQ0UsT0FBTyxHQUFHLElBQUk7SUFDeEIsQ0FBQztFQUNILENBQUMsRUFBRSxFQUFFLENBQUM7RUFFTixJQUFBVyxnQkFBQSxHQUF1Q2IsT0FBTyxDQUFDRSxPQUFPO0lBQTlDTyxPQUFPLEdBQUFJLGdCQUFBLENBQVBKLE9BQU87SUFBRUUsaUJBQUEsR0FBQUUsZ0JBQUEsQ0FBQUYsaUJBQUE7RUFFakJILFlBQVksR0FBR00saUJBQWlCLENBQUNOLFlBQVksRUFBRUQsUUFBUSxDQUFDO0VBRXhELElBQU1RLG9CQUFvQixHQUFHLENBQUNDLG9CQUFvQixDQUNoRFIsWUFBWSxFQUNaRyxpQkFBaUIsQ0FDbEI7RUFDRFgsT0FBTyxDQUFDRSxPQUFPLENBQUNTLGlCQUFpQixHQUFHSCxZQUFZO0VBQ2hELElBQU1TLE1BQU0sR0FBRyxJQUFBQyxzQkFBSyxHQUFFLElBQUksSUFBQUMsdUJBQU0sR0FBRTtFQUVsQyxPQUFPO0lBQUVWLE9BQU8sRUFBUEEsT0FBTztJQUFFTSxvQkFBb0IsRUFBcEJBLG9CQUFvQjtJQUFFRSxNQUFBLEVBQUFBO0VBQU8sQ0FBQztBQUVsRCxDQUFtQjtBQUFBWixPQUFBLENBQUFDLFVBQUEsR0FBQUEsVUFBQTtBQUdaLFNBQVNjLGlCQUFpQkEsQ0FDL0JiLFFBQWtFLEVBQzFEO0VBQ1IsT0FBT2MsTUFBTSxDQUFDQyxNQUFNLENBQUNmLFFBQVEsQ0FBQyxDQUFDZ0IsTUFBTSxDQUNuQyxVQUFDQyxHQUFXLEVBQUVDLE9BQXdCO0lBQUEsT0FFcENELEdBQUcsR0FBR0MsT0FBTyxDQUFDQyxhQUFhLENBQUVDLFFBQVEsRUFBRTtFQUFBLEdBQ3pDLEVBQUUsQ0FDSDtBQUNIO0FBR08sU0FBU2IsaUJBQWlCQSxDQUMvQk4sWUFBNEIsRUFDNUJELFFBQXFELEVBQ3JDO0VBQ2hCLElBQU1xQixZQUErQixHQUFHUCxNQUFNLENBQUNDLE1BQU0sQ0FBQ2YsUUFBUSxDQUFDLENBQUNzQixNQUFNLENBQ25FLFVBQUFuQyxPQUFPO0lBQUEsT0FBS0EsT0FBTyxLQUFLSSxTQUFTO0VBQUEsRUFDZDtFQUN0QixJQUFJLENBQUNVLFlBQVksRUFBRTtJQUNqQkEsWUFBWSxHQUFHb0IsWUFBWSxDQUFDRSxHQUFHLENBQUUsVUFBQXBDLE9BQU8sRUFBSztNQUMzQyxPQUFPO1FBQ0xxQyxXQUFXLEVBQUVyQyxPQUFPLENBQUNnQyxhQUFhO1FBQ2xDTSxPQUFPLEVBQUV0QyxPQUFPLENBQUN1QztNQUNuQixDQUFDO0lBQ0gsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxNQUFNO0lBQ0x6QixZQUFZLENBQUMwQixJQUFJLENBQUNkLGlCQUFpQixDQUFDUSxZQUFZLENBQUMsQ0FBQztFQUNwRDtFQUVBLE9BQU9wQixZQUFZO0FBQ3JCO0FBR08sU0FBU1Esb0JBQW9CQSxDQUNsQ21CLFFBQXdCLEVBQ3hCQyxRQUF3QixFQUNmO0VBQ1QsU0FBU0MsRUFBRUEsQ0FBQ0MsQ0FBUyxFQUFFQyxDQUFTLEVBQUU7SUFFaEMsT0FBUUQsQ0FBQyxLQUFLQyxDQUFDLEtBQUtELENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHQSxDQUFDLEtBQUssQ0FBQyxHQUFHQyxDQUFDLENBQUMsSUFBTUQsQ0FBQyxLQUFLQSxDQUFDLElBQUlDLENBQUMsS0FBS0EsQ0FBRTtFQUUxRTtFQUNBLElBQU1DLFFBQTJELEdBQy9ELE9BQU9uQixNQUFNLENBQUNnQixFQUFFLEtBQUssVUFBVSxHQUFHaEIsTUFBTSxDQUFDZ0IsRUFBRSxHQUFHQSxFQUFFO0VBRWxELFNBQVNJLGtCQUFrQkEsQ0FDekJOLFFBQXdCLEVBQ3hCQyxRQUF3QixFQUNmO0lBQ1QsSUFBSSxDQUFDRCxRQUFRLElBQUksQ0FBQ0MsUUFBUSxJQUFJQSxRQUFRLENBQUN2QyxNQUFNLEtBQUtzQyxRQUFRLENBQUN0QyxNQUFNLEVBQUU7TUFDakUsT0FBTyxLQUFLO0lBQ2Q7SUFDQSxLQUFLLElBQUk2QyxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUdOLFFBQVEsQ0FBQ3ZDLE1BQU0sRUFBRSxFQUFFNkMsQ0FBQyxFQUFFO01BQ3hDLElBQUksQ0FBQ0YsUUFBUSxDQUFDTCxRQUFRLENBQUNPLENBQUMsQ0FBQyxFQUFFTixRQUFRLENBQUNNLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDdkMsT0FBTyxLQUFLO01BQ2Q7SUFDRjtJQUNBLE9BQU8sSUFBSTtFQUNiO0VBRUEsT0FBT0Qsa0JBQWtCLENBQUNOLFFBQVEsRUFBRUMsUUFBUSxDQUFDO0FBQy9DO0FBRU8sU0FBU08sYUFBYUEsQ0FBQ0MsT0FBc0IsRUFBVztFQUM3RCxJQUFNQyxhQUFhLEdBQUcsSUFBSUMsR0FBRyxDQUFDQyx1QkFBVSxDQUFDO0VBQ3pDLEtBQUssSUFBTUMsR0FBRyxJQUFJSixPQUFPLEVBQUU7SUFDekIsSUFBSUMsYUFBYSxDQUFDSSxHQUFHLENBQUNELEdBQUcsQ0FBQyxFQUFFO01BQzFCLE9BQU8sSUFBSTtJQUNiO0VBQ0Y7RUFDQSxPQUFPLEtBQUs7QUFDZDtBQUVPLFNBQVNFLFdBQVdBLENBQUNOLE9BQXNCLEVBQVE7RUFDeEQsU0FBUzs7RUFDVCxLQUFLLElBQU1JLEdBQUcsSUFBSUosT0FBTyxFQUFFO0lBQ3pCLElBQUlHLHVCQUFVLENBQUNJLE9BQU8sQ0FBQ0gsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7TUFHbEMsSUFBTUksY0FBYyxHQUFHLElBQUFDLG9CQUFZLEVBQUNULE9BQU8sQ0FBQ0ksR0FBRyxDQUFDLENBQUM7TUFDakQsSUFBSUksY0FBYyxLQUFLdEQsU0FBUyxFQUFFO1FBQ2hDOEMsT0FBTyxDQUFDSSxHQUFHLENBQUMsR0FBR0ksY0FBYztNQUMvQjtJQUNGO0VBQ0Y7QUFDRjtBQUVPLFNBQVNFLFVBQVVBLENBQUNDLElBQXlDLEVBQVc7RUFDN0UsU0FBUzs7RUFDVCxJQUFJQyxLQUFLLENBQUNDLE9BQU8sQ0FBQ0YsSUFBSSxDQUFDLEVBQUU7SUFDdkIsT0FBT0EsSUFBSSxDQUFDRyxJQUFJLENBQUNKLFVBQVUsQ0FBQztFQUM5QixDQUFDLE1BQU0sSUFBSSxPQUFPQyxJQUFJLEtBQUssUUFBUSxJQUFJQSxJQUFJLEtBQUssSUFBSSxFQUFFO0lBQ3BELElBQUlBLElBQUksQ0FBQ0ksT0FBTyxLQUFLN0QsU0FBUyxFQUFFO01BQzlCLE9BQU8sSUFBSTtJQUNiLENBQUMsTUFBTTtNQUNMLE9BQU91QixNQUFNLENBQUNDLE1BQU0sQ0FBQ2lDLElBQUksQ0FBQyxDQUFDRyxJQUFJLENBQUNKLFVBQVUsQ0FBQztJQUM3QztFQUNGO0VBQ0EsT0FBTyxLQUFLO0FBQ2Q7QUFFTyxTQUFTTSxZQUFZQSxDQUFDQyxDQUFNLEVBQUVDLENBQU0sRUFBRTtFQUMzQyxTQUFTOztFQUNULElBQU1DLEtBQUssR0FBRzFDLE1BQU0sQ0FBQzJDLElBQUksQ0FBQ0gsQ0FBQyxDQUFDO0VBQzVCLElBQU1JLEtBQUssR0FBRzVDLE1BQU0sQ0FBQzJDLElBQUksQ0FBQ0YsQ0FBQyxDQUFDO0VBQzVCLElBQUlDLEtBQUssQ0FBQ2xFLE1BQU0sS0FBS29FLEtBQUssQ0FBQ3BFLE1BQU0sRUFBRTtJQUNqQyxPQUFPLEtBQUs7RUFDZDtFQUNBLEtBQUssSUFBSTZDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsR0FBR3FCLEtBQUssQ0FBQ2xFLE1BQU0sRUFBRTZDLENBQUMsRUFBRSxFQUFFO0lBQ3JDLElBQUltQixDQUFDLENBQUNFLEtBQUssQ0FBQ3JCLENBQUMsQ0FBQyxDQUFDLEtBQUtvQixDQUFDLENBQUNDLEtBQUssQ0FBQ3JCLENBQUMsQ0FBQyxDQUFDLEVBQUU7TUFDL0IsT0FBTyxLQUFLO0lBQ2Q7RUFDRjtFQUNBLE9BQU8sSUFBSTtBQUNiO0FBRU8sSUFBTXdCLHNCQUFzQixHQUFJLFNBQTFCQSxzQkFBc0JBLENBQUlDLE1BQXFCLEVBQVc7RUFDckUsU0FBUzs7RUFDVCxJQUFJLE9BQU9BLE1BQU0sS0FBSyxRQUFRLEVBQUU7SUFDOUIsTUFBTSxJQUFJQyxLQUFLLENBQ1osbURBQWtELE9BQU9ELE1BQU8sVUFBUyxDQUMzRTtFQUNILENBQUMsTUFBTSxJQUFJWCxLQUFLLENBQUNDLE9BQU8sQ0FBQ1UsTUFBTSxDQUFDLEVBQUU7SUFDaEMsTUFBTSxJQUFJQyxLQUFLLENBQ2IsMEpBQTBKLENBQzNKO0VBQ0g7QUFDRixDQUFDO0FBQUEvRCxPQUFBLENBQUE2RCxzQkFBQSxHQUFBQSxzQkFBQSJ9