3b658b881c00ae9a56071389857547f8
var _styleAnimation = require("../animation/styleAnimation");
var _mutables = require("../mutables");
var _animationBuilder = require("./animationBuilder");
var _threads = require("../threads");
var TAG_OFFSET = 1e9;
function startObservingProgress(tag, sharedValue, animationType) {
  'worklet';

  var isSharedTransition = animationType === _animationBuilder.LayoutAnimationType.SHARED_ELEMENT_TRANSITION;
  sharedValue.addListener(tag + TAG_OFFSET, function () {
    _notifyAboutProgress(tag, sharedValue.value, isSharedTransition);
  });
}
function stopObservingProgress(tag, sharedValue, removeView) {
  'worklet';

  sharedValue.removeListener(tag + TAG_OFFSET);
  _notifyAboutEnd(tag, removeView);
}
function createLayoutAnimationManager() {
  'worklet';

  var enteringAnimationForTag = new Map();
  var mutableValuesForTag = new Map();
  return {
    start: function start(tag, type, yogaValues, config) {
      if (type === _animationBuilder.LayoutAnimationType.SHARED_ELEMENT_TRANSITION_PROGRESS) {
        global.ProgressTransitionRegister.onTransitionStart(tag, yogaValues);
        return;
      }
      var style = config(yogaValues);
      var currentAnimation = style.animations;
      if (type === _animationBuilder.LayoutAnimationType.ENTERING) {
        enteringAnimationForTag.set(tag, currentAnimation);
      } else if (type === _animationBuilder.LayoutAnimationType.LAYOUT) {
        var enteringAnimation = enteringAnimationForTag.get(tag);
        if (enteringAnimation) {
          currentAnimation = Object.assign({}, enteringAnimation, style.animations);
        }
      }
      var value = mutableValuesForTag.get(tag);
      if (value === undefined) {
        value = (0, _mutables.makeUIMutable)(style.initialValues);
        mutableValuesForTag.set(tag, value);
      } else {
        stopObservingProgress(tag, value, false);
        value._value = style.initialValues;
      }
      var animation = (0, _styleAnimation.withStyleAnimation)(currentAnimation);
      animation.callback = function (finished) {
        if (finished) {
          enteringAnimationForTag.delete(tag);
          mutableValuesForTag.delete(tag);
          var shouldRemoveView = type === _animationBuilder.LayoutAnimationType.EXITING;
          stopObservingProgress(tag, value, shouldRemoveView);
        }
        style.callback && style.callback(finished === undefined ? false : finished);
      };
      startObservingProgress(tag, value, type);
      value.value = animation;
    },
    stop: function stop(tag) {
      var value = mutableValuesForTag.get(tag);
      if (!value) {
        return;
      }
      stopObservingProgress(tag, value, true);
    }
  };
}
(0, _threads.runOnUIImmediately)(function () {
  'worklet';

  global.LayoutAnimationsManager = createLayoutAnimationManager();
})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3R5bGVBbmltYXRpb24iLCJyZXF1aXJlIiwiX211dGFibGVzIiwiX2FuaW1hdGlvbkJ1aWxkZXIiLCJfdGhyZWFkcyIsIlRBR19PRkZTRVQiLCJzdGFydE9ic2VydmluZ1Byb2dyZXNzIiwidGFnIiwic2hhcmVkVmFsdWUiLCJhbmltYXRpb25UeXBlIiwiaXNTaGFyZWRUcmFuc2l0aW9uIiwiTGF5b3V0QW5pbWF0aW9uVHlwZSIsIlNIQVJFRF9FTEVNRU5UX1RSQU5TSVRJT04iLCJhZGRMaXN0ZW5lciIsIl9ub3RpZnlBYm91dFByb2dyZXNzIiwidmFsdWUiLCJzdG9wT2JzZXJ2aW5nUHJvZ3Jlc3MiLCJyZW1vdmVWaWV3IiwicmVtb3ZlTGlzdGVuZXIiLCJfbm90aWZ5QWJvdXRFbmQiLCJjcmVhdGVMYXlvdXRBbmltYXRpb25NYW5hZ2VyIiwiZW50ZXJpbmdBbmltYXRpb25Gb3JUYWciLCJNYXAiLCJtdXRhYmxlVmFsdWVzRm9yVGFnIiwic3RhcnQiLCJ0eXBlIiwieW9nYVZhbHVlcyIsImNvbmZpZyIsIlNIQVJFRF9FTEVNRU5UX1RSQU5TSVRJT05fUFJPR1JFU1MiLCJnbG9iYWwiLCJQcm9ncmVzc1RyYW5zaXRpb25SZWdpc3RlciIsIm9uVHJhbnNpdGlvblN0YXJ0Iiwic3R5bGUiLCJjdXJyZW50QW5pbWF0aW9uIiwiYW5pbWF0aW9ucyIsIkVOVEVSSU5HIiwic2V0IiwiTEFZT1VUIiwiZW50ZXJpbmdBbmltYXRpb24iLCJnZXQiLCJPYmplY3QiLCJhc3NpZ24iLCJ1bmRlZmluZWQiLCJtYWtlVUlNdXRhYmxlIiwiaW5pdGlhbFZhbHVlcyIsIl92YWx1ZSIsImFuaW1hdGlvbiIsIndpdGhTdHlsZUFuaW1hdGlvbiIsImNhbGxiYWNrIiwiZmluaXNoZWQiLCJkZWxldGUiLCJzaG91bGRSZW1vdmVWaWV3IiwiRVhJVElORyIsInN0b3AiLCJydW5PblVJSW1tZWRpYXRlbHkiLCJMYXlvdXRBbmltYXRpb25zTWFuYWdlciJdLCJzb3VyY2VzIjpbImFuaW1hdGlvbnNNYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHdpdGhTdHlsZUFuaW1hdGlvbiB9IGZyb20gJy4uL2FuaW1hdGlvbi9zdHlsZUFuaW1hdGlvbic7XG5pbXBvcnQgdHlwZSB7IFNoYXJlZFZhbHVlIH0gZnJvbSAnLi4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHsgbWFrZVVJTXV0YWJsZSB9IGZyb20gJy4uL211dGFibGVzJztcbmltcG9ydCB0eXBlIHtcbiAgTGF5b3V0QW5pbWF0aW9uRnVuY3Rpb24sXG4gIExheW91dEFuaW1hdGlvbnNWYWx1ZXMsXG59IGZyb20gJy4vYW5pbWF0aW9uQnVpbGRlcic7XG5pbXBvcnQgeyBMYXlvdXRBbmltYXRpb25UeXBlIH0gZnJvbSAnLi9hbmltYXRpb25CdWlsZGVyJztcbmltcG9ydCB7IHJ1bk9uVUlJbW1lZGlhdGVseSB9IGZyb20gJy4uL3RocmVhZHMnO1xuXG5jb25zdCBUQUdfT0ZGU0VUID0gMWU5O1xuXG5mdW5jdGlvbiBzdGFydE9ic2VydmluZ1Byb2dyZXNzKFxuICB0YWc6IG51bWJlcixcbiAgc2hhcmVkVmFsdWU6IFNoYXJlZFZhbHVlPFJlY29yZDxzdHJpbmcsIHVua25vd24+PixcbiAgYW5pbWF0aW9uVHlwZTogTGF5b3V0QW5pbWF0aW9uVHlwZVxuKTogdm9pZCB7XG4gICd3b3JrbGV0JztcbiAgY29uc3QgaXNTaGFyZWRUcmFuc2l0aW9uID1cbiAgICBhbmltYXRpb25UeXBlID09PSBMYXlvdXRBbmltYXRpb25UeXBlLlNIQVJFRF9FTEVNRU5UX1RSQU5TSVRJT047XG4gIHNoYXJlZFZhbHVlLmFkZExpc3RlbmVyKHRhZyArIFRBR19PRkZTRVQsICgpID0+IHtcbiAgICBfbm90aWZ5QWJvdXRQcm9ncmVzcyh0YWcsIHNoYXJlZFZhbHVlLnZhbHVlLCBpc1NoYXJlZFRyYW5zaXRpb24pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gc3RvcE9ic2VydmluZ1Byb2dyZXNzKFxuICB0YWc6IG51bWJlcixcbiAgc2hhcmVkVmFsdWU6IFNoYXJlZFZhbHVlPG51bWJlcj4sXG4gIHJlbW92ZVZpZXc6IGJvb2xlYW5cbik6IHZvaWQge1xuICAnd29ya2xldCc7XG4gIHNoYXJlZFZhbHVlLnJlbW92ZUxpc3RlbmVyKHRhZyArIFRBR19PRkZTRVQpO1xuICBfbm90aWZ5QWJvdXRFbmQodGFnLCByZW1vdmVWaWV3KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlTGF5b3V0QW5pbWF0aW9uTWFuYWdlcigpIHtcbiAgJ3dvcmtsZXQnO1xuICBjb25zdCBlbnRlcmluZ0FuaW1hdGlvbkZvclRhZyA9IG5ldyBNYXAoKTtcbiAgY29uc3QgbXV0YWJsZVZhbHVlc0ZvclRhZyA9IG5ldyBNYXAoKTtcblxuICByZXR1cm4ge1xuICAgIHN0YXJ0KFxuICAgICAgdGFnOiBudW1iZXIsXG4gICAgICB0eXBlOiBMYXlvdXRBbmltYXRpb25UeXBlLFxuICAgICAgeW9nYVZhbHVlczogTGF5b3V0QW5pbWF0aW9uc1ZhbHVlcyxcbiAgICAgIGNvbmZpZzogTGF5b3V0QW5pbWF0aW9uRnVuY3Rpb25cbiAgICApIHtcbiAgICAgIGlmICh0eXBlID09PSBMYXlvdXRBbmltYXRpb25UeXBlLlNIQVJFRF9FTEVNRU5UX1RSQU5TSVRJT05fUFJPR1JFU1MpIHtcbiAgICAgICAgZ2xvYmFsLlByb2dyZXNzVHJhbnNpdGlvblJlZ2lzdGVyLm9uVHJhbnNpdGlvblN0YXJ0KHRhZywgeW9nYVZhbHVlcyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3R5bGUgPSBjb25maWcoeW9nYVZhbHVlcyk7XG4gICAgICBsZXQgY3VycmVudEFuaW1hdGlvbiA9IHN0eWxlLmFuaW1hdGlvbnM7XG5cbiAgICAgIGlmICh0eXBlID09PSBMYXlvdXRBbmltYXRpb25UeXBlLkVOVEVSSU5HKSB7XG4gICAgICAgIGVudGVyaW5nQW5pbWF0aW9uRm9yVGFnLnNldCh0YWcsIGN1cnJlbnRBbmltYXRpb24pO1xuICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBMYXlvdXRBbmltYXRpb25UeXBlLkxBWU9VVCkge1xuICAgICAgICAvLyBXaGVuIGxheW91dCBhbmltYXRpb24gaXMgcmVxdWVzdGVkLCBidXQgZW50ZXJpbmcgaXMgc3RpbGwgcnVubmluZywgd2UgbWVyZ2VcbiAgICAgICAgLy8gbmV3IGxheW91dCBhbmltYXRpb24gdGFyZ2V0cyBpbnRvIHRoZSBvbmdvaW5nIGFuaW1hdGlvblxuICAgICAgICBjb25zdCBlbnRlcmluZ0FuaW1hdGlvbiA9IGVudGVyaW5nQW5pbWF0aW9uRm9yVGFnLmdldCh0YWcpO1xuICAgICAgICBpZiAoZW50ZXJpbmdBbmltYXRpb24pIHtcbiAgICAgICAgICBjdXJyZW50QW5pbWF0aW9uID0geyAuLi5lbnRlcmluZ0FuaW1hdGlvbiwgLi4uc3R5bGUuYW5pbWF0aW9ucyB9O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCB2YWx1ZSA9IG11dGFibGVWYWx1ZXNGb3JUYWcuZ2V0KHRhZyk7XG4gICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2YWx1ZSA9IG1ha2VVSU11dGFibGUoc3R5bGUuaW5pdGlhbFZhbHVlcyk7XG4gICAgICAgIG11dGFibGVWYWx1ZXNGb3JUYWcuc2V0KHRhZywgdmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3RvcE9ic2VydmluZ1Byb2dyZXNzKHRhZywgdmFsdWUsIGZhbHNlKTtcbiAgICAgICAgdmFsdWUuX3ZhbHVlID0gc3R5bGUuaW5pdGlhbFZhbHVlcztcbiAgICAgIH1cblxuICAgICAgLy8gQHRzLWlnbm9yZSBUaGUgbGluZSBiZWxvdyBzdGFydGVkIGZhaWxpbmcgYmVjYXVzZSBJIGFkZGVkIHR5cGVzIHRvIHRoZSBtZXRob2Qg4oCTIGRvbid0IGhhdmUgdGltZSB0byBmaXggaXQgcmlnaHQgbm93XG4gICAgICBjb25zdCBhbmltYXRpb24gPSB3aXRoU3R5bGVBbmltYXRpb24oY3VycmVudEFuaW1hdGlvbik7XG5cbiAgICAgIGFuaW1hdGlvbi5jYWxsYmFjayA9IChmaW5pc2hlZD86IGJvb2xlYW4pID0+IHtcbiAgICAgICAgaWYgKGZpbmlzaGVkKSB7XG4gICAgICAgICAgZW50ZXJpbmdBbmltYXRpb25Gb3JUYWcuZGVsZXRlKHRhZyk7XG4gICAgICAgICAgbXV0YWJsZVZhbHVlc0ZvclRhZy5kZWxldGUodGFnKTtcbiAgICAgICAgICBjb25zdCBzaG91bGRSZW1vdmVWaWV3ID0gdHlwZSA9PT0gTGF5b3V0QW5pbWF0aW9uVHlwZS5FWElUSU5HO1xuICAgICAgICAgIHN0b3BPYnNlcnZpbmdQcm9ncmVzcyh0YWcsIHZhbHVlLCBzaG91bGRSZW1vdmVWaWV3KTtcbiAgICAgICAgfVxuICAgICAgICBzdHlsZS5jYWxsYmFjayAmJlxuICAgICAgICAgIHN0eWxlLmNhbGxiYWNrKGZpbmlzaGVkID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGZpbmlzaGVkKTtcbiAgICAgIH07XG5cbiAgICAgIHN0YXJ0T2JzZXJ2aW5nUHJvZ3Jlc3ModGFnLCB2YWx1ZSwgdHlwZSk7XG4gICAgICB2YWx1ZS52YWx1ZSA9IGFuaW1hdGlvbjtcbiAgICB9LFxuICAgIHN0b3AodGFnOiBudW1iZXIpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbXV0YWJsZVZhbHVlc0ZvclRhZy5nZXQodGFnKTtcbiAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgc3RvcE9ic2VydmluZ1Byb2dyZXNzKHRhZywgdmFsdWUsIHRydWUpO1xuICAgIH0sXG4gIH07XG59XG5cbnJ1bk9uVUlJbW1lZGlhdGVseSgoKSA9PiB7XG4gICd3b3JrbGV0JztcbiAgZ2xvYmFsLkxheW91dEFuaW1hdGlvbnNNYW5hZ2VyID0gY3JlYXRlTGF5b3V0QW5pbWF0aW9uTWFuYWdlcigpO1xufSkoKTtcblxuZXhwb3J0IHR5cGUgTGF5b3V0QW5pbWF0aW9uc01hbmFnZXIgPSBSZXR1cm5UeXBlPFxuICB0eXBlb2YgY3JlYXRlTGF5b3V0QW5pbWF0aW9uTWFuYWdlclxuPjtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQUEsZUFBQSxHQUFBQyxPQUFBO0FBRUEsSUFBQUMsU0FBQSxHQUFBRCxPQUFBO0FBS0EsSUFBQUUsaUJBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLFFBQUEsR0FBQUgsT0FBQTtBQUVBLElBQU1JLFVBQVUsR0FBRyxHQUFHO0FBRXRCLFNBQVNDLHNCQUFzQkEsQ0FDN0JDLEdBQVcsRUFDWEMsV0FBaUQsRUFDakRDLGFBQWtDLEVBQzVCO0VBQ04sU0FBUzs7RUFDVCxJQUFNQyxrQkFBa0IsR0FDdEJELGFBQWEsS0FBS0UscUNBQW1CLENBQUNDLHlCQUF5QjtFQUNqRUosV0FBVyxDQUFDSyxXQUFXLENBQUNOLEdBQUcsR0FBR0YsVUFBVSxFQUFFLFlBQU07SUFDOUNTLG9CQUFvQixDQUFDUCxHQUFHLEVBQUVDLFdBQVcsQ0FBQ08sS0FBSyxFQUFFTCxrQkFBa0IsQ0FBQztFQUNsRSxDQUFDLENBQUM7QUFDSjtBQUVBLFNBQVNNLHFCQUFxQkEsQ0FDNUJULEdBQVcsRUFDWEMsV0FBZ0MsRUFDaENTLFVBQW1CLEVBQ2I7RUFDTixTQUFTOztFQUNUVCxXQUFXLENBQUNVLGNBQWMsQ0FBQ1gsR0FBRyxHQUFHRixVQUFVLENBQUM7RUFDNUNjLGVBQWUsQ0FBQ1osR0FBRyxFQUFFVSxVQUFVLENBQUM7QUFDbEM7QUFFQSxTQUFTRyw0QkFBNEJBLENBQUEsRUFBRztFQUN0QyxTQUFTOztFQUNULElBQU1DLHVCQUF1QixHQUFHLElBQUlDLEdBQUcsRUFBRTtFQUN6QyxJQUFNQyxtQkFBbUIsR0FBRyxJQUFJRCxHQUFHLEVBQUU7RUFFckMsT0FBTztJQUNMRSxLQUFLLFdBQUFBLE1BQ0hqQixHQUFXLEVBQ1hrQixJQUF5QixFQUN6QkMsVUFBa0MsRUFDbENDLE1BQStCLEVBQy9CO01BQ0EsSUFBSUYsSUFBSSxLQUFLZCxxQ0FBbUIsQ0FBQ2lCLGtDQUFrQyxFQUFFO1FBQ25FQyxNQUFNLENBQUNDLDBCQUEwQixDQUFDQyxpQkFBaUIsQ0FBQ3hCLEdBQUcsRUFBRW1CLFVBQVUsQ0FBQztRQUNwRTtNQUNGO01BRUEsSUFBTU0sS0FBSyxHQUFHTCxNQUFNLENBQUNELFVBQVUsQ0FBQztNQUNoQyxJQUFJTyxnQkFBZ0IsR0FBR0QsS0FBSyxDQUFDRSxVQUFVO01BRXZDLElBQUlULElBQUksS0FBS2QscUNBQW1CLENBQUN3QixRQUFRLEVBQUU7UUFDekNkLHVCQUF1QixDQUFDZSxHQUFHLENBQUM3QixHQUFHLEVBQUUwQixnQkFBZ0IsQ0FBQztNQUNwRCxDQUFDLE1BQU0sSUFBSVIsSUFBSSxLQUFLZCxxQ0FBbUIsQ0FBQzBCLE1BQU0sRUFBRTtRQUc5QyxJQUFNQyxpQkFBaUIsR0FBR2pCLHVCQUF1QixDQUFDa0IsR0FBRyxDQUFDaEMsR0FBRyxDQUFDO1FBQzFELElBQUkrQixpQkFBaUIsRUFBRTtVQUNyQkwsZ0JBQWdCLEdBQUFPLE1BQUEsQ0FBQUMsTUFBQSxLQUFRSCxpQkFBaUIsRUFBS04sS0FBSyxDQUFDRSxVQUFBLENBQVk7UUFDbEU7TUFDRjtNQUVBLElBQUluQixLQUFLLEdBQUdRLG1CQUFtQixDQUFDZ0IsR0FBRyxDQUFDaEMsR0FBRyxDQUFDO01BQ3hDLElBQUlRLEtBQUssS0FBSzJCLFNBQVMsRUFBRTtRQUN2QjNCLEtBQUssR0FBRyxJQUFBNEIsdUJBQWEsRUFBQ1gsS0FBSyxDQUFDWSxhQUFhLENBQUM7UUFDMUNyQixtQkFBbUIsQ0FBQ2EsR0FBRyxDQUFDN0IsR0FBRyxFQUFFUSxLQUFLLENBQUM7TUFDckMsQ0FBQyxNQUFNO1FBQ0xDLHFCQUFxQixDQUFDVCxHQUFHLEVBQUVRLEtBQUssRUFBRSxLQUFLLENBQUM7UUFDeENBLEtBQUssQ0FBQzhCLE1BQU0sR0FBR2IsS0FBSyxDQUFDWSxhQUFhO01BQ3BDO01BR0EsSUFBTUUsU0FBUyxHQUFHLElBQUFDLGtDQUFrQixFQUFDZCxnQkFBZ0IsQ0FBQztNQUV0RGEsU0FBUyxDQUFDRSxRQUFRLEdBQUksVUFBQUMsUUFBa0IsRUFBSztRQUMzQyxJQUFJQSxRQUFRLEVBQUU7VUFDWjVCLHVCQUF1QixDQUFDNkIsTUFBTSxDQUFDM0MsR0FBRyxDQUFDO1VBQ25DZ0IsbUJBQW1CLENBQUMyQixNQUFNLENBQUMzQyxHQUFHLENBQUM7VUFDL0IsSUFBTTRDLGdCQUFnQixHQUFHMUIsSUFBSSxLQUFLZCxxQ0FBbUIsQ0FBQ3lDLE9BQU87VUFDN0RwQyxxQkFBcUIsQ0FBQ1QsR0FBRyxFQUFFUSxLQUFLLEVBQUVvQyxnQkFBZ0IsQ0FBQztRQUNyRDtRQUNBbkIsS0FBSyxDQUFDZ0IsUUFBUSxJQUNaaEIsS0FBSyxDQUFDZ0IsUUFBUSxDQUFDQyxRQUFRLEtBQUtQLFNBQVMsR0FBRyxLQUFLLEdBQUdPLFFBQVEsQ0FBQztNQUM3RCxDQUFDO01BRUQzQyxzQkFBc0IsQ0FBQ0MsR0FBRyxFQUFFUSxLQUFLLEVBQUVVLElBQUksQ0FBQztNQUN4Q1YsS0FBSyxDQUFDQSxLQUFLLEdBQUcrQixTQUFTO0lBQ3pCLENBQUM7SUFDRE8sSUFBSSxXQUFBQSxLQUFDOUMsR0FBVyxFQUFFO01BQ2hCLElBQU1RLEtBQUssR0FBR1EsbUJBQW1CLENBQUNnQixHQUFHLENBQUNoQyxHQUFHLENBQUM7TUFDMUMsSUFBSSxDQUFDUSxLQUFLLEVBQUU7UUFDVjtNQUNGO01BQ0FDLHFCQUFxQixDQUFDVCxHQUFHLEVBQUVRLEtBQUssRUFBRSxJQUFJLENBQUM7SUFDekM7RUFDRixDQUFDO0FBQ0g7QUFFQSxJQUFBdUMsMkJBQWtCLEVBQUMsWUFBTTtFQUN2QixTQUFTOztFQUNUekIsTUFBTSxDQUFDMEIsdUJBQXVCLEdBQUduQyw0QkFBNEIsRUFBRTtBQUNqRSxDQUFDLENBQUMsRUFBRSJ9