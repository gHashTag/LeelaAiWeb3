128ada7c7e9660fff49d6158b5ef45c2
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.makeShareable = makeShareable;
exports.makeShareableCloneOnUIRecursive = makeShareableCloneOnUIRecursive;
exports.makeShareableCloneRecursive = makeShareableCloneRecursive;
exports.registerShareableMapping = registerShareableMapping;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _NativeReanimated = _interopRequireDefault(require("./NativeReanimated"));
var _PlatformChecker = require("./PlatformChecker");
var _errors = require("./errors");
var _jsVersion = require("./platform-specific/jsVersion");
var USE_STUB_IMPLEMENTATION = (0, _PlatformChecker.shouldBeUseWeb)();
var _shareableCache = new WeakMap();
var _shareableFlag = Symbol('shareable flag');
var MAGIC_KEY = 'REANIMATED_MAGIC_KEY';
function isHostObject(value) {
  return MAGIC_KEY in value;
}
function registerShareableMapping(shareable, shareableRef) {
  if (USE_STUB_IMPLEMENTATION) {
    return;
  }
  _shareableCache.set(shareable, shareableRef || _shareableFlag);
}
function isPlainJSObject(object) {
  return Object.getPrototypeOf(object) === Object.prototype;
}
var INACCESSIBLE_OBJECT = {
  __init: function __init() {
    'worklet';

    return new Proxy({}, {
      get: function get(_, prop) {
        if (prop === '_isReanimatedSharedValue') {
          return false;
        }
        throw new Error(`Trying to access property \`${String(prop)}\` of an object which cannot be sent to the UI runtime.`);
      },
      set: function set() {
        throw new Error('Trying to write to an object which cannot be sent to the UI runtime.');
      }
    });
  }
};
var DETECT_CYCLIC_OBJECT_DEPTH_THRESHOLD = 30;
var processedObjectAtThresholdDepth;
function makeShareableCloneRecursive(value) {
  var shouldPersistRemote = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  var depth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
  if (USE_STUB_IMPLEMENTATION) {
    return value;
  }
  if (depth >= DETECT_CYCLIC_OBJECT_DEPTH_THRESHOLD) {
    if (depth === DETECT_CYCLIC_OBJECT_DEPTH_THRESHOLD) {
      processedObjectAtThresholdDepth = value;
    } else if (value === processedObjectAtThresholdDepth) {
      throw new Error('Trying to convert a cyclic object to a shareable. This is not supported.');
    }
  } else {
    processedObjectAtThresholdDepth = undefined;
  }
  var type = typeof value;
  var isTypeObject = type === 'object';
  var isTypeFunction = type === 'function';
  if ((isTypeObject || isTypeFunction) && value !== null) {
    var cached = _shareableCache.get(value);
    if (cached === _shareableFlag) {
      return value;
    } else if (cached !== undefined) {
      return cached;
    } else {
      var toAdapt;
      if (Array.isArray(value)) {
        toAdapt = value.map(function (element) {
          return makeShareableCloneRecursive(element, shouldPersistRemote, depth + 1);
        });
      } else if (isTypeFunction && value.__workletHash === undefined) {
        toAdapt = value;
      } else if (isHostObject(value)) {
        toAdapt = value;
      } else if (isPlainJSObject(value) || isTypeFunction) {
        toAdapt = {};
        if (value.__workletHash !== undefined) {
          if (__DEV__) {
            var babelVersion = value.__initData.version;
            if (babelVersion === undefined) {
              throw new Error(`[Reanimated] Unknown version of Reanimated Babel plugin.
1. Try resetting your Metro bundler cache with \`yarn start --reset-cache\`, \`npm start -- --reset-cache\` or \`expo start -c\` and run the app again.
2. Make sure that none of your dependencies contains already transformed worklets bundled with an outdated version of the Reanimated Babel plugin.
3. Using release bundle with debug build of the app is not supported.
Offending code was: \`${getWorkletCode(value)}\``);
            } else if (babelVersion !== _jsVersion.jsVersion) {
              throw new Error(`[Reanimated] Mismatch between JavaScript code version and Reanimated Babel plugin version (${_jsVersion.jsVersion} vs. ${babelVersion}).        
1. Try resetting your Metro bundler cache with \`yarn start --reset-cache\`, \`npm start -- --reset-cache\` or \`expo start -c\` and run the app again.
2. Make sure that none of your dependencies contains already transformed worklets bundled with an outdated version of the Reanimated Babel plugin.
Offending code was: \`${getWorkletCode(value)}\``);
            }
            (0, _errors.registerWorkletStackDetails)(value.__workletHash, value.__stackDetails);
            delete value.__stackDetails;
          } else if (value.__stackDetails) {
            throw new Error('[Reanimated] Using dev bundle in a release app build is not supported. Visit https://github.com/software-mansion/react-native-reanimated/issues/4737 to find more information on how to fix this issue.');
          }
          toAdapt.__initData = makeShareableCloneRecursive(value.__initData, true, depth + 1);
          delete value.__initData;
        }
        for (var _ref of Object.entries(value)) {
          var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
          var key = _ref2[0];
          var element = _ref2[1];
          toAdapt[key] = makeShareableCloneRecursive(element, shouldPersistRemote, depth + 1);
        }
      } else if (value instanceof RegExp) {
        var pattern = value.source;
        var flags = value.flags;
        var handle = makeShareableCloneRecursive({
          __init: function __init() {
            'worklet';

            return new RegExp(pattern, flags);
          }
        });
        registerShareableMapping(value, handle);
        return handle;
      } else {
        var inaccessibleObject = makeShareableCloneRecursive(INACCESSIBLE_OBJECT);
        _shareableCache.set(value, inaccessibleObject);
        return inaccessibleObject;
      }
      if (__DEV__) {
        Object.freeze(value);
      }
      var adopted = _NativeReanimated.default.makeShareableClone(toAdapt, shouldPersistRemote);
      _shareableCache.set(value, adopted);
      _shareableCache.set(adopted, _shareableFlag);
      return adopted;
    }
  }
  return _NativeReanimated.default.makeShareableClone(value, shouldPersistRemote);
}
var WORKLET_CODE_THRESHOLD = 255;
function getWorkletCode(value) {
  var _value$__initData;
  var code = value === null || value === void 0 ? void 0 : (_value$__initData = value.__initData) === null || _value$__initData === void 0 ? void 0 : _value$__initData.code;
  if (!code) {
    return 'unknown';
  }
  if (code.length > WORKLET_CODE_THRESHOLD) {
    return `${code.substring(0, WORKLET_CODE_THRESHOLD)}...`;
  }
  return code;
}
function makeShareableCloneOnUIRecursive(value) {
  'worklet';

  if (USE_STUB_IMPLEMENTATION) {
    return value;
  }
  function cloneRecursive(value) {
    var type = typeof value;
    if ((type === 'object' || type === 'function') && value !== null) {
      var toAdapt;
      if (Array.isArray(value)) {
        toAdapt = value.map(function (element) {
          return cloneRecursive(element);
        });
      } else if (value !== undefined) {
        toAdapt = {};
        for (var _ref3 of Object.entries(value)) {
          var _ref4 = (0, _slicedToArray2.default)(_ref3, 2);
          var key = _ref4[0];
          var element = _ref4[1];
          toAdapt[key] = cloneRecursive(element);
        }
      }
      return _makeShareableClone(toAdapt);
    }
    return _makeShareableClone(value);
  }
  return cloneRecursive(value);
}
function makeShareable(value) {
  if (USE_STUB_IMPLEMENTATION) {
    return value;
  }
  var handle = makeShareableCloneRecursive({
    __init: function __init() {
      'worklet';

      return value;
    }
  });
  registerShareableMapping(value, handle);
  return value;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfTmF0aXZlUmVhbmltYXRlZCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX1BsYXRmb3JtQ2hlY2tlciIsIl9lcnJvcnMiLCJfanNWZXJzaW9uIiwiVVNFX1NUVUJfSU1QTEVNRU5UQVRJT04iLCJzaG91bGRCZVVzZVdlYiIsIl9zaGFyZWFibGVDYWNoZSIsIldlYWtNYXAiLCJfc2hhcmVhYmxlRmxhZyIsIlN5bWJvbCIsIk1BR0lDX0tFWSIsImlzSG9zdE9iamVjdCIsInZhbHVlIiwicmVnaXN0ZXJTaGFyZWFibGVNYXBwaW5nIiwic2hhcmVhYmxlIiwic2hhcmVhYmxlUmVmIiwic2V0IiwiaXNQbGFpbkpTT2JqZWN0Iiwib2JqZWN0IiwiT2JqZWN0IiwiZ2V0UHJvdG90eXBlT2YiLCJwcm90b3R5cGUiLCJJTkFDQ0VTU0lCTEVfT0JKRUNUIiwiX19pbml0IiwiUHJveHkiLCJnZXQiLCJfIiwicHJvcCIsIkVycm9yIiwiU3RyaW5nIiwiREVURUNUX0NZQ0xJQ19PQkpFQ1RfREVQVEhfVEhSRVNIT0xEIiwicHJvY2Vzc2VkT2JqZWN0QXRUaHJlc2hvbGREZXB0aCIsIm1ha2VTaGFyZWFibGVDbG9uZVJlY3Vyc2l2ZSIsInNob3VsZFBlcnNpc3RSZW1vdGUiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJkZXB0aCIsInR5cGUiLCJpc1R5cGVPYmplY3QiLCJpc1R5cGVGdW5jdGlvbiIsImNhY2hlZCIsInRvQWRhcHQiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJlbGVtZW50IiwiX193b3JrbGV0SGFzaCIsIl9fREVWX18iLCJiYWJlbFZlcnNpb24iLCJfX2luaXREYXRhIiwidmVyc2lvbiIsImdldFdvcmtsZXRDb2RlIiwianNWZXJzaW9uIiwicmVnaXN0ZXJXb3JrbGV0U3RhY2tEZXRhaWxzIiwiX19zdGFja0RldGFpbHMiLCJfcmVmIiwiZW50cmllcyIsIl9yZWYyIiwiX3NsaWNlZFRvQXJyYXkyIiwiZGVmYXVsdCIsImtleSIsIlJlZ0V4cCIsInBhdHRlcm4iLCJzb3VyY2UiLCJmbGFncyIsImhhbmRsZSIsImluYWNjZXNzaWJsZU9iamVjdCIsImZyZWV6ZSIsImFkb3B0ZWQiLCJOYXRpdmVSZWFuaW1hdGVkTW9kdWxlIiwibWFrZVNoYXJlYWJsZUNsb25lIiwiV09SS0xFVF9DT0RFX1RIUkVTSE9MRCIsIl92YWx1ZSRfX2luaXREYXRhIiwiY29kZSIsInN1YnN0cmluZyIsIm1ha2VTaGFyZWFibGVDbG9uZU9uVUlSZWN1cnNpdmUiLCJjbG9uZVJlY3Vyc2l2ZSIsIl9yZWYzIiwiX3JlZjQiLCJfbWFrZVNoYXJlYWJsZUNsb25lIiwibWFrZVNoYXJlYWJsZSJdLCJzb3VyY2VzIjpbInNoYXJlYWJsZXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IE5hdGl2ZVJlYW5pbWF0ZWRNb2R1bGUgZnJvbSAnLi9OYXRpdmVSZWFuaW1hdGVkJztcbmltcG9ydCB0eXBlIHsgU2hhcmVhYmxlUmVmLCBXb3JrbGV0RnVuY3Rpb24gfSBmcm9tICcuL2NvbW1vblR5cGVzJztcbmltcG9ydCB7IHNob3VsZEJlVXNlV2ViIH0gZnJvbSAnLi9QbGF0Zm9ybUNoZWNrZXInO1xuaW1wb3J0IHsgcmVnaXN0ZXJXb3JrbGV0U3RhY2tEZXRhaWxzIH0gZnJvbSAnLi9lcnJvcnMnO1xuaW1wb3J0IHsganNWZXJzaW9uIH0gZnJvbSAnLi9wbGF0Zm9ybS1zcGVjaWZpYy9qc1ZlcnNpb24nO1xuXG4vLyBmb3Igd2ViL2Nocm9tZSBkZWJ1Z2dlci9qZXN0IGVudmlyb25tZW50cyB0aGlzIGZpbGUgcHJvdmlkZXMgYSBzdHViIGltcGxlbWVudGF0aW9uXG4vLyB3aGVyZSBubyBzaGFyZWFibGUgcmVmZXJlbmNlcyBhcmUgdXNlZC4gSW5zdGVhZCwgdGhlIG9iamVjdHMgdGhlbXNlbHZlcyBhcmUgdXNlZFxuLy8gaW5zdGVhZCBvZiBzaGFyZWFibGUgcmVmZXJlbmNlcywgYmVjYXVzZSBvZiB0aGUgZmFjdCB0aGF0IHdlIGRvbid0IGhhdmUgdG8gZGVhbCB3aXRoXG4vLyBydW5ubmluZyB0aGUgY29kZSBvbiBzZXBhcmF0ZSBWTXMuXG5jb25zdCBVU0VfU1RVQl9JTVBMRU1FTlRBVElPTiA9IHNob3VsZEJlVXNlV2ViKCk7XG5cbmNvbnN0IF9zaGFyZWFibGVDYWNoZSA9IG5ldyBXZWFrTWFwPFxuICBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgU2hhcmVhYmxlUmVmPGFueT4gfCBzeW1ib2xcbj4oKTtcbi8vIHRoZSBiZWxvdyBzeW1ib2wgaXMgdXNlZCB0byByZXByZXNlbnQgYSBtYXBwaW5nIGZyb20gdGhlIHZhbHVlIHRvIGl0c2VsZlxuLy8gdGhpcyBpcyB1c2VkIHRvIGFsbG93IGZvciBhIGNvbnZlcnRlZCBzaGFyZWFibGUgdG8gYmUgcGFzc2VkIHRvIG1ha2VTaGFyZWFibGVDbG9uZVxuY29uc3QgX3NoYXJlYWJsZUZsYWcgPSBTeW1ib2woJ3NoYXJlYWJsZSBmbGFnJyk7XG5cbmNvbnN0IE1BR0lDX0tFWSA9ICdSRUFOSU1BVEVEX01BR0lDX0tFWSc7XG5cbmZ1bmN0aW9uIGlzSG9zdE9iamVjdCh2YWx1ZTogTm9uTnVsbGFibGU8b2JqZWN0Pik6IGJvb2xlYW4ge1xuICAvLyBXZSBjb3VsZCB1c2UgSlNJIHRvIGRldGVybWluZSB3aGV0aGVyIGFuIG9iamVjdCBpcyBhIGhvc3Qgb2JqZWN0LCBob3dldmVyXG4gIC8vIHRoZSBiZWxvdyB3b3JrYXJvdW5kIHdvcmtzIHdlbGwgYW5kIGlzIHdheSBmYXN0ZXIgdGhhbiBhbiBhZGRpdGlvbmFsIEpTSSBjYWxsLlxuICAvLyBXZSB1c2UgdGhlIGZhY3QgdGhhdCBob3N0IG9iamVjdHMgaGF2ZSBicm9rZW4gaW1wbGVtZW50YXRpb24gb2YgYGhhc093blByb3BlcnR5YFxuICAvLyBhbmQgaGVuY2UgcmV0dXJuIHRydWUgZm9yIGFsbCBgaW5gIGNoZWNrcyByZWdhcmRsZXNzIG9mIHRoZSBrZXkgd2UgYXNrIGZvci5cbiAgcmV0dXJuIE1BR0lDX0tFWSBpbiB2YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyU2hhcmVhYmxlTWFwcGluZyhcbiAgc2hhcmVhYmxlOiBhbnksXG4gIHNoYXJlYWJsZVJlZj86IFNoYXJlYWJsZVJlZjxhbnk+XG4pOiB2b2lkIHtcbiAgaWYgKFVTRV9TVFVCX0lNUExFTUVOVEFUSU9OKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIF9zaGFyZWFibGVDYWNoZS5zZXQoc2hhcmVhYmxlLCBzaGFyZWFibGVSZWYgfHwgX3NoYXJlYWJsZUZsYWcpO1xufVxuXG5mdW5jdGlvbiBpc1BsYWluSlNPYmplY3Qob2JqZWN0OiBvYmplY3QpIHtcbiAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpID09PSBPYmplY3QucHJvdG90eXBlO1xufVxuXG4vLyBUaGUgYmVsb3cgb2JqZWN0IGlzIHVzZWQgYXMgYSByZXBsYWNlbWVudCBmb3Igb2JqZWN0cyB0aGF0IGNhbm5vdCBiZSB0cmFuc2ZlcnJlZFxuLy8gYXMgc2hhcmVhYmxlIHZhbHVlcy4gSW4gbWFrZVNoYXJlYWJsZUNsb25lUmVjdXJzaXZlIHdlIGRldGVjdCBpZiBhbiBvYmplY3QgaXMgb2Zcbi8vIGEgcGxhaW4gT2JqZWN0LnByb3RvdHlwZSBhbmQgb25seSBhbGxvdyBzdWNoIG9iamVjdHMgdG8gYmUgdHJhbnNmZXJyZWQuIFRoaXMgbGV0c1xuLy8gdXMgYXZvaWQgYWxsIHNvcnRzIG9mIHJlYWN0IGludGVybmFscyBmcm9tIGxlYWtpbmcgaW50byB0aGUgVUkgcnVudGltZS4gVG8gbWFrZSBpdFxuLy8gcG9zc2libGUgdG8gY2F0Y2ggZXJyb3JzIHdoZW4gc29tZW9uZSBhY3R1YWxseSB0cmllcyB0byBhY2Nlc3Mgc3VjaCBvYmplY3Qgb24gdGhlIFVJXG4vLyBydW50aW1lLCB3ZSB1c2UgdGhlIGJlbG93IFByb3h5IG9iamVjdCB3aGljaCBpcyBpbnN0YW50aWF0ZWQgb24gdGhlIFVJIHJ1bnRpbWUgYW5kXG4vLyB0aHJvd3Mgd2hlbmV2ZXIgc29tZW9uZSB0cmllcyB0byBhY2Nlc3MgaXRzIGZpZWxkcy5cbmNvbnN0IElOQUNDRVNTSUJMRV9PQkpFQ1QgPSB7XG4gIF9faW5pdDogKCkgPT4ge1xuICAgICd3b3JrbGV0JztcbiAgICByZXR1cm4gbmV3IFByb3h5KFxuICAgICAge30sXG4gICAgICB7XG4gICAgICAgIGdldDogKF86IGFueSwgcHJvcDogc3RyaW5nIHwgc3ltYm9sKSA9PiB7XG4gICAgICAgICAgaWYgKHByb3AgPT09ICdfaXNSZWFuaW1hdGVkU2hhcmVkVmFsdWUnKSB7XG4gICAgICAgICAgICAvLyBub3QgdmVyeSBoYXBweSBhYm91dCB0aGlzIGNoZWNrIGhlcmUsIGJ1dCB3ZSBuZWVkIHRvIGFsbG93IGZvclxuICAgICAgICAgICAgLy8gXCJpbmFjY2Vzc2libGVcIiBvYmplY3RzIHRvIGJlIHRlc3RlZCB3aXRoIGlzU2hhcmVkVmFsdWUgY2hlY2tcbiAgICAgICAgICAgIC8vIGFzIGl0IGlzIGJlaW5nIHVzZWQgaW4gdGhlIG1hcHBlcnMgd2hlbiBleHRyYWNpbmcgaW5wdXRzIHJlY3Vyc2l2ZWx5LlxuICAgICAgICAgICAgLy8gQXBwYXJlbnRseSB3ZSBjYW4ndCBjaGVjayBpZiBhIGtleSBleGlzdHMgdGhlcmUgYXMgSG9zdE9iamVjdHMgYWx3YXlzXG4gICAgICAgICAgICAvLyByZXR1cm4gdHJ1ZSBmb3Igc3VjaCB0ZXN0cywgc28gdGhlIG9ubHkgcG9zc2liaWxpdHkgZm9yIHVzIGlzIHRvXG4gICAgICAgICAgICAvLyBhY3R1YWxseSBhY2Nlc3MgdGhhdCBrZXkgYW5kIHNlZSBpZiBpdCBpcyBzZXQgdG8gdHJ1ZS4gV2UgdGhlcmVmb3JlXG4gICAgICAgICAgICAvLyBuZWVkIHRvIGFsbG93IGZvciB0aGlzIGtleSB0byBiZSBhY2Nlc3NlZCBoZXJlLlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgVHJ5aW5nIHRvIGFjY2VzcyBwcm9wZXJ0eSBcXGAke1N0cmluZyhcbiAgICAgICAgICAgICAgcHJvcFxuICAgICAgICAgICAgKX1cXGAgb2YgYW4gb2JqZWN0IHdoaWNoIGNhbm5vdCBiZSBzZW50IHRvIHRoZSBVSSBydW50aW1lLmBcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6ICgpID0+IHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnVHJ5aW5nIHRvIHdyaXRlIHRvIGFuIG9iamVjdCB3aGljaCBjYW5ub3QgYmUgc2VudCB0byB0aGUgVUkgcnVudGltZS4nXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuICB9LFxufTtcblxuY29uc3QgREVURUNUX0NZQ0xJQ19PQkpFQ1RfREVQVEhfVEhSRVNIT0xEID0gMzA7XG4vLyBCZWxvdyB2YXJpYWJsZSBzdG9yZXMgb2JqZWN0IHRoYXQgd2UgcHJvY2VzcyBpbiBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmUgYXQgdGhlIHNwZWNpZmllZCBkZXB0aC5cbi8vIFdlIHVzZSBpdCB0byBjaGVjayBpZiBsYXRlciBvbiB0aGUgZnVuY3Rpb24gcmVlbnRlcnMgd2l0aCB0aGUgc2FtZSBvYmplY3RcbmxldCBwcm9jZXNzZWRPYmplY3RBdFRocmVzaG9sZERlcHRoOiBhbnk7XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmU8VD4oXG4gIHZhbHVlOiBhbnksXG4gIHNob3VsZFBlcnNpc3RSZW1vdGUgPSBmYWxzZSxcbiAgZGVwdGggPSAwXG4pOiBTaGFyZWFibGVSZWY8VD4ge1xuICBpZiAoVVNFX1NUVUJfSU1QTEVNRU5UQVRJT04pIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgaWYgKGRlcHRoID49IERFVEVDVF9DWUNMSUNfT0JKRUNUX0RFUFRIX1RIUkVTSE9MRCkge1xuICAgIC8vIGlmIHdlIHJlYWNoIGNlcnRhaW4gcmVjdXJzaW9uIGRlcHRoIHdlIHN1c3BlY3QgdGhhdCB3ZSBhcmUgZGVhbGluZyB3aXRoIGEgY3ljbGljIG9iamVjdC5cbiAgICAvLyB0aGlzIHR5cGUgb2Ygb2JqZWN0cyBhcmUgbm90IHN1cHBvcnRlZCBhbmQgY2Fubm90IGJlIHRyYXNmZXJyZWQgYXMgc2hhcmVhYmxlLCBzbyB3ZVxuICAgIC8vIGltcGxlbWVudCBhIHNpbXBsZSBkZXRlY3Rpb24gbWVjaGFuaXNtIHRoYXQgcmVtZW1iZXJzIHRoZSB2YWx1ZSBhdCBhIGdpdmVuIGRlcHRoIGFuZFxuICAgIC8vIHRlc3RzIHdoZXRoZXIgd2UgdHJ5IHJlZW50ZXIgdGhpcyBtZXRob2QgbGF0ZXIgb24gd2l0aCB0aGUgc2FtZSB2YWx1ZS4gSWYgdGhhdCBoYXBwZW5zXG4gICAgLy8gd2UgdGhyb3cgYW4gYXBwcm9wcmlhdGUgZXJyb3IuXG4gICAgaWYgKGRlcHRoID09PSBERVRFQ1RfQ1lDTElDX09CSkVDVF9ERVBUSF9USFJFU0hPTEQpIHtcbiAgICAgIHByb2Nlc3NlZE9iamVjdEF0VGhyZXNob2xkRGVwdGggPSB2YWx1ZTtcbiAgICB9IGVsc2UgaWYgKHZhbHVlID09PSBwcm9jZXNzZWRPYmplY3RBdFRocmVzaG9sZERlcHRoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdUcnlpbmcgdG8gY29udmVydCBhIGN5Y2xpYyBvYmplY3QgdG8gYSBzaGFyZWFibGUuIFRoaXMgaXMgbm90IHN1cHBvcnRlZC4nXG4gICAgICApO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBwcm9jZXNzZWRPYmplY3RBdFRocmVzaG9sZERlcHRoID0gdW5kZWZpbmVkO1xuICB9XG4gIC8vIFRoaXMgb25lIGFjdHVhbGx5IG1heSBiZSB3b3J0aCB0byBiZSBtb3ZlZCB0byBjKyssIHdlIGFsc28gbmVlZCBzaW1pbGFyIGxvZ2ljIHRvIHJ1biBvbiB0aGUgVUkgdGhyZWFkXG4gIGNvbnN0IHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gIGNvbnN0IGlzVHlwZU9iamVjdCA9IHR5cGUgPT09ICdvYmplY3QnO1xuICBjb25zdCBpc1R5cGVGdW5jdGlvbiA9IHR5cGUgPT09ICdmdW5jdGlvbic7XG4gIGlmICgoaXNUeXBlT2JqZWN0IHx8IGlzVHlwZUZ1bmN0aW9uKSAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgIGNvbnN0IGNhY2hlZCA9IF9zaGFyZWFibGVDYWNoZS5nZXQodmFsdWUpO1xuICAgIGlmIChjYWNoZWQgPT09IF9zaGFyZWFibGVGbGFnKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfSBlbHNlIGlmIChjYWNoZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGNhY2hlZCBhcyBTaGFyZWFibGVSZWY8VD47XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB0b0FkYXB0OiBhbnk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgdG9BZGFwdCA9IHZhbHVlLm1hcCgoZWxlbWVudCkgPT5cbiAgICAgICAgICBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmUoZWxlbWVudCwgc2hvdWxkUGVyc2lzdFJlbW90ZSwgZGVwdGggKyAxKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChpc1R5cGVGdW5jdGlvbiAmJiB2YWx1ZS5fX3dvcmtsZXRIYXNoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy8gdGhpcyBpcyBhIHJlbW90ZSBmdW5jdGlvblxuICAgICAgICB0b0FkYXB0ID0gdmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKGlzSG9zdE9iamVjdCh2YWx1ZSkpIHtcbiAgICAgICAgLy8gZm9yIGhvc3Qgb2JqZWN0cyB3ZSBwYXNzIHRoZSByZWZlcmVuY2UgdG8gdGhlIG9iamVjdCBhcyBzaGFyZWFibGUgYW5kXG4gICAgICAgIC8vIHRoZW4gcmVjcmVhdGUgbmV3IGhvc3Qgb2JqZWN0IHdyYXBwaW5nIHRoZSBzYW1lIGluc3RhbmNlIG9uIHRoZSBVSSB0aHJlYWQuXG4gICAgICAgIC8vIHRoZXJlIGlzIG5vIHBvaW50IG9mIGl0ZXJhdGluZyBvdmVyIGtleXMgYXMgd2UgZG8gZm9yIHJlZ3VsYXIgb2JqZWN0cy5cbiAgICAgICAgdG9BZGFwdCA9IHZhbHVlO1xuICAgICAgfSBlbHNlIGlmIChpc1BsYWluSlNPYmplY3QodmFsdWUpIHx8IGlzVHlwZUZ1bmN0aW9uKSB7XG4gICAgICAgIHRvQWRhcHQgPSB7fTtcbiAgICAgICAgaWYgKHZhbHVlLl9fd29ya2xldEhhc2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIC8vIHdlIGFyZSBjb252ZXJ0aW5nIGEgd29ya2xldFxuICAgICAgICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICAgICAgICBjb25zdCBiYWJlbFZlcnNpb24gPSB2YWx1ZS5fX2luaXREYXRhLnZlcnNpb247XG4gICAgICAgICAgICBpZiAoYmFiZWxWZXJzaW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbUmVhbmltYXRlZF0gVW5rbm93biB2ZXJzaW9uIG9mIFJlYW5pbWF0ZWQgQmFiZWwgcGx1Z2luLlxuMS4gVHJ5IHJlc2V0dGluZyB5b3VyIE1ldHJvIGJ1bmRsZXIgY2FjaGUgd2l0aCBcXGB5YXJuIHN0YXJ0IC0tcmVzZXQtY2FjaGVcXGAsIFxcYG5wbSBzdGFydCAtLSAtLXJlc2V0LWNhY2hlXFxgIG9yIFxcYGV4cG8gc3RhcnQgLWNcXGAgYW5kIHJ1biB0aGUgYXBwIGFnYWluLlxuMi4gTWFrZSBzdXJlIHRoYXQgbm9uZSBvZiB5b3VyIGRlcGVuZGVuY2llcyBjb250YWlucyBhbHJlYWR5IHRyYW5zZm9ybWVkIHdvcmtsZXRzIGJ1bmRsZWQgd2l0aCBhbiBvdXRkYXRlZCB2ZXJzaW9uIG9mIHRoZSBSZWFuaW1hdGVkIEJhYmVsIHBsdWdpbi5cbjMuIFVzaW5nIHJlbGVhc2UgYnVuZGxlIHdpdGggZGVidWcgYnVpbGQgb2YgdGhlIGFwcCBpcyBub3Qgc3VwcG9ydGVkLlxuT2ZmZW5kaW5nIGNvZGUgd2FzOiBcXGAke2dldFdvcmtsZXRDb2RlKHZhbHVlKX1cXGBgKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoYmFiZWxWZXJzaW9uICE9PSBqc1ZlcnNpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbUmVhbmltYXRlZF0gTWlzbWF0Y2ggYmV0d2VlbiBKYXZhU2NyaXB0IGNvZGUgdmVyc2lvbiBhbmQgUmVhbmltYXRlZCBCYWJlbCBwbHVnaW4gdmVyc2lvbiAoJHtqc1ZlcnNpb259IHZzLiAke2JhYmVsVmVyc2lvbn0pLiAgICAgICAgXG4xLiBUcnkgcmVzZXR0aW5nIHlvdXIgTWV0cm8gYnVuZGxlciBjYWNoZSB3aXRoIFxcYHlhcm4gc3RhcnQgLS1yZXNldC1jYWNoZVxcYCwgXFxgbnBtIHN0YXJ0IC0tIC0tcmVzZXQtY2FjaGVcXGAgb3IgXFxgZXhwbyBzdGFydCAtY1xcYCBhbmQgcnVuIHRoZSBhcHAgYWdhaW4uXG4yLiBNYWtlIHN1cmUgdGhhdCBub25lIG9mIHlvdXIgZGVwZW5kZW5jaWVzIGNvbnRhaW5zIGFscmVhZHkgdHJhbnNmb3JtZWQgd29ya2xldHMgYnVuZGxlZCB3aXRoIGFuIG91dGRhdGVkIHZlcnNpb24gb2YgdGhlIFJlYW5pbWF0ZWQgQmFiZWwgcGx1Z2luLlxuT2ZmZW5kaW5nIGNvZGUgd2FzOiBcXGAke2dldFdvcmtsZXRDb2RlKHZhbHVlKX1cXGBgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZ2lzdGVyV29ya2xldFN0YWNrRGV0YWlscyhcbiAgICAgICAgICAgICAgdmFsdWUuX193b3JrbGV0SGFzaCxcbiAgICAgICAgICAgICAgdmFsdWUuX19zdGFja0RldGFpbHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBkZWxldGUgdmFsdWUuX19zdGFja0RldGFpbHM7XG4gICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5fX3N0YWNrRGV0YWlscykge1xuICAgICAgICAgICAgLy8gRGV0ZWN0ZWQgZGVidWcgdmVyc2lvbiBvZiB0aGUgd29ya2xldCBpbiByZWxlYXNlIGJ1bmRsZS4gVGhpc1xuICAgICAgICAgICAgLy8gbWlnaHQgbGVhZCB0byB1bmV4cGVjdGVkIGlzc3VlcyBvciBlcnJvcnMuIFByb2JhYmx5IG9uZSBvZiB1c2VyXG4gICAgICAgICAgICAvLyBkZXBlbmRlbmNpZXMgcHJvdmlkZWQgdHJhbnNwaWxlZCBjb2RlIHdpdGggZGVidWcgdmVyc2lvbiBvZiB0aGVcbiAgICAgICAgICAgIC8vIFJlYW5pbWF0ZWQgcGx1Z2luLlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAnW1JlYW5pbWF0ZWRdIFVzaW5nIGRldiBidW5kbGUgaW4gYSByZWxlYXNlIGFwcCBidWlsZCBpcyBub3Qgc3VwcG9ydGVkLiBWaXNpdCBodHRwczovL2dpdGh1Yi5jb20vc29mdHdhcmUtbWFuc2lvbi9yZWFjdC1uYXRpdmUtcmVhbmltYXRlZC9pc3N1ZXMvNDczNyB0byBmaW5kIG1vcmUgaW5mb3JtYXRpb24gb24gaG93IHRvIGZpeCB0aGlzIGlzc3VlLidcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIHRvIHNhdmUgb24gdHJhbnNmZXJyaW5nIHN0YXRpYyBfX2luaXREYXRhIGZpZWxkIG9mIHdvcmtsZXQgc3RydWN0dXJlXG4gICAgICAgICAgLy8gd2UgcmVxdWVzdCBzaGFyZWFibGUgdmFsdWUgdG8gcGVyc2lzdCBpdHMgVUkgY291bnRlcnBhcnQuIFRoaXMgbWVhbnNcbiAgICAgICAgICAvLyB0aGF0IHRoZSBfX2luaXREYXRhIGZpZWxkIHRoYXQgY29udGFpbnMgbG9uZyBzdHJpbmdzIHJlcHJlc2V0aW5nIHRoZVxuICAgICAgICAgIC8vIHdvcmtsZXQgY29kZSwgc291cmNlIG1hcCwgYW5kIGxvY2F0aW9uLCB3aWxsIGFsd2F5cyBiZVxuICAgICAgICAgIC8vIHNlcmlhbGl6ZWQvZGVzZXJpYWxpemVkIG9uY2UuXG4gICAgICAgICAgdG9BZGFwdC5fX2luaXREYXRhID0gbWFrZVNoYXJlYWJsZUNsb25lUmVjdXJzaXZlKFxuICAgICAgICAgICAgdmFsdWUuX19pbml0RGF0YSxcbiAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICBkZXB0aCArIDFcbiAgICAgICAgICApO1xuICAgICAgICAgIGRlbGV0ZSB2YWx1ZS5fX2luaXREYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBba2V5LCBlbGVtZW50XSBvZiBPYmplY3QuZW50cmllcyh2YWx1ZSkpIHtcbiAgICAgICAgICB0b0FkYXB0W2tleV0gPSBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmUoXG4gICAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgICAgc2hvdWxkUGVyc2lzdFJlbW90ZSxcbiAgICAgICAgICAgIGRlcHRoICsgMVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgICAgY29uc3QgcGF0dGVybiA9IHZhbHVlLnNvdXJjZTtcbiAgICAgICAgY29uc3QgZmxhZ3MgPSB2YWx1ZS5mbGFncztcbiAgICAgICAgY29uc3QgaGFuZGxlID0gbWFrZVNoYXJlYWJsZUNsb25lUmVjdXJzaXZlKHtcbiAgICAgICAgICBfX2luaXQ6ICgpID0+IHtcbiAgICAgICAgICAgICd3b3JrbGV0JztcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKHBhdHRlcm4sIGZsYWdzKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgcmVnaXN0ZXJTaGFyZWFibGVNYXBwaW5nKHZhbHVlLCBoYW5kbGUpO1xuICAgICAgICByZXR1cm4gaGFuZGxlIGFzIFNoYXJlYWJsZVJlZjxUPjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRoaXMgaXMgcmVhY2hlZCBmb3Igb2JqZWN0IHR5cGVzIHRoYXQgYXJlIG5vdCBvZiBwbGFpbiBPYmplY3QucHJvdG90eXBlLlxuICAgICAgICAvLyBXZSBkb24ndCBzdXBwb3J0IHN1Y2ggb2JqZWN0cyBmcm9tIGJlaW5nIHRyYW5zZmVycmVkIGFzIHNoYXJlYWJsZXMgdG9cbiAgICAgICAgLy8gdGhlIFVJIHJ1bnRpbWUgYW5kIGhlbmNlIHdlIHJlcGxhY2UgdGhlbSB3aXRoIFwiaW5hY2Nlc3NpYmxlIG9iamVjdFwiXG4gICAgICAgIC8vIHdoaWNoIGlzIGltcGxlbWVudGVkIGFzIGEgUHJveHkgb2JqZWN0IHRoYXQgdGhyb3dzIG9uIGFueSBhdHRlbXB0XG4gICAgICAgIC8vIG9mIGFjY2Vzc2luZyBpdHMgZmllbGRzLiBXZSBhcmd1ZSB0aGF0IHN1Y2ggb2JqZWN0cyBjYW4gc29tZXRpbWVzIGxlYWtcbiAgICAgICAgLy8gYXMgYXR0cmlidXRlcyBvZiBvYmplY3RzIGJlaW5nIGNhcHR1cmVkIGJ5IHdvcmtsZXRzIGJ1dCBzaG91bGQgbmV2ZXJcbiAgICAgICAgLy8gYmUgdXNlZCBvbiB0aGUgVUkgcnVudGltZSByZWdhcmRsZXNzLiBJZiB0aGV5IGFyZSBiZWluZyBhY2Nlc3NlZCwgdGhlIHVzZXJcbiAgICAgICAgLy8gd2lsbCBnZXQgYW4gYXBwcm9wcmlhdGUgZXJyb3IgbWVzc2FnZS5cbiAgICAgICAgY29uc3QgaW5hY2Nlc3NpYmxlT2JqZWN0ID1cbiAgICAgICAgICBtYWtlU2hhcmVhYmxlQ2xvbmVSZWN1cnNpdmU8VD4oSU5BQ0NFU1NJQkxFX09CSkVDVCk7XG4gICAgICAgIF9zaGFyZWFibGVDYWNoZS5zZXQodmFsdWUsIGluYWNjZXNzaWJsZU9iamVjdCk7XG4gICAgICAgIHJldHVybiBpbmFjY2Vzc2libGVPYmplY3Q7XG4gICAgICB9XG4gICAgICBpZiAoX19ERVZfXykge1xuICAgICAgICAvLyB3ZSBmcmVlemUgb2JqZWN0cyB0aGF0IGFyZSB0cmFuc2Zvcm1lZCB0byBzaGFyZWFibGUuIFRoaXMgc2hvdWxkIGhlbHBcbiAgICAgICAgLy8gZGV0ZWN0IGlzc3VlcyB3aGVuIHNvbWVvbmUgbW9kaWZpZXMgZGF0YSBhZnRlciBpdCdzIGJlZW4gY29udmVydGVkIHRvXG4gICAgICAgIC8vIHNoYXJlYWJsZS4gTWVhbmluZyB0aGF0IHRoZXkgbWF5IGJlIGRvaW5nIGEgZmF1bHR5IGFzc3VtcHRpb24gaW4gdGhlaXJcbiAgICAgICAgLy8gY29kZSBleHBlY3RpbmcgdGhhdCB0aGUgdXBkYXRlcyBhcmUgZ29pbmcgdG8gYXV0b21hdGljYWxseSBwb3B1bGF0ZSB0b1xuICAgICAgICAvLyB0aGUgb2JqZWN0IHNlbnQgdG8gdGhlIFVJIHRocmVhZC4gSWYgdGhlIHVzZXIgcmVhbGx5IHdhbnRzIHNvbWUgb2JqZWN0c1xuICAgICAgICAvLyB0byBiZSBtdXRhYmxlIHRoZXkgc2hvdWxkIHVzZSBzaGFyZWQgdmFsdWVzIGluc3RlYWQuXG4gICAgICAgIE9iamVjdC5mcmVlemUodmFsdWUpO1xuICAgICAgfVxuICAgICAgY29uc3QgYWRvcHRlZCA9IE5hdGl2ZVJlYW5pbWF0ZWRNb2R1bGUubWFrZVNoYXJlYWJsZUNsb25lKFxuICAgICAgICB0b0FkYXB0LFxuICAgICAgICBzaG91bGRQZXJzaXN0UmVtb3RlXG4gICAgICApO1xuICAgICAgX3NoYXJlYWJsZUNhY2hlLnNldCh2YWx1ZSwgYWRvcHRlZCk7XG4gICAgICBfc2hhcmVhYmxlQ2FjaGUuc2V0KGFkb3B0ZWQsIF9zaGFyZWFibGVGbGFnKTtcbiAgICAgIHJldHVybiBhZG9wdGVkO1xuICAgIH1cbiAgfVxuICByZXR1cm4gTmF0aXZlUmVhbmltYXRlZE1vZHVsZS5tYWtlU2hhcmVhYmxlQ2xvbmUodmFsdWUsIHNob3VsZFBlcnNpc3RSZW1vdGUpO1xufVxuXG5jb25zdCBXT1JLTEVUX0NPREVfVEhSRVNIT0xEID0gMjU1O1xuXG5mdW5jdGlvbiBnZXRXb3JrbGV0Q29kZSh2YWx1ZTogV29ya2xldEZ1bmN0aW9uKSB7XG4gIC8vIEB0cy1pZ25vcmUgdGhpcyBpcyBmaW5lXG4gIGNvbnN0IGNvZGUgPSB2YWx1ZT8uX19pbml0RGF0YT8uY29kZTtcbiAgaWYgKCFjb2RlKSB7XG4gICAgcmV0dXJuICd1bmtub3duJztcbiAgfVxuICBpZiAoY29kZS5sZW5ndGggPiBXT1JLTEVUX0NPREVfVEhSRVNIT0xEKSB7XG4gICAgcmV0dXJuIGAke2NvZGUuc3Vic3RyaW5nKDAsIFdPUktMRVRfQ09ERV9USFJFU0hPTEQpfS4uLmA7XG4gIH1cbiAgcmV0dXJuIGNvZGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlU2hhcmVhYmxlQ2xvbmVPblVJUmVjdXJzaXZlPFQ+KHZhbHVlOiBUKTogU2hhcmVhYmxlUmVmPFQ+IHtcbiAgJ3dvcmtsZXQnO1xuICBpZiAoVVNFX1NUVUJfSU1QTEVNRU5UQVRJT04pIHtcbiAgICAvLyBAdHMtaWdub3JlIHdlYiBpcyBhbiBpbnRlcmVzdGluZyBwbGFjZSB3aGVyZSB3ZSBkb24ndCBydW4gYSBzZWNvbmRhcnkgVk0gb24gdGhlIFVJIHRocmVhZFxuICAgIC8vIHNlZSBtb3JlIGRldGFpbHMgaW4gdGhlIGNvbW1lbnQgd2hlcmUgVVNFX1NUVUJfSU1QTEVNRU5UQVRJT04gaXMgZGVmaW5lZC5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgZnVuY3Rpb24gY2xvbmVSZWN1cnNpdmU8VD4odmFsdWU6IFQpOiBTaGFyZWFibGVSZWY8VD4ge1xuICAgIGNvbnN0IHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gICAgaWYgKCh0eXBlID09PSAnb2JqZWN0JyB8fCB0eXBlID09PSAnZnVuY3Rpb24nKSAmJiB2YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgbGV0IHRvQWRhcHQ6IGFueTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB0b0FkYXB0ID0gdmFsdWUubWFwKChlbGVtZW50KSA9PiBjbG9uZVJlY3Vyc2l2ZShlbGVtZW50KSk7XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdG9BZGFwdCA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGVsZW1lbnRdIG9mIE9iamVjdC5lbnRyaWVzKFxuICAgICAgICAgIHZhbHVlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gICAgICAgICkpIHtcbiAgICAgICAgICB0b0FkYXB0W2tleV0gPSBjbG9uZVJlY3Vyc2l2ZShlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIF9tYWtlU2hhcmVhYmxlQ2xvbmUodG9BZGFwdCk7XG4gICAgfVxuICAgIHJldHVybiBfbWFrZVNoYXJlYWJsZUNsb25lKHZhbHVlKTtcbiAgfVxuICByZXR1cm4gY2xvbmVSZWN1cnNpdmUodmFsdWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFrZVNoYXJlYWJsZTxUPih2YWx1ZTogVCk6IFQge1xuICBpZiAoVVNFX1NUVUJfSU1QTEVNRU5UQVRJT04pIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgY29uc3QgaGFuZGxlID0gbWFrZVNoYXJlYWJsZUNsb25lUmVjdXJzaXZlKHtcbiAgICBfX2luaXQ6ICgpID0+IHtcbiAgICAgICd3b3JrbGV0JztcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9LFxuICB9KTtcbiAgcmVnaXN0ZXJTaGFyZWFibGVNYXBwaW5nKHZhbHVlLCBoYW5kbGUpO1xuICByZXR1cm4gdmFsdWU7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLElBQUFBLGlCQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFBQyxnQkFBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsT0FBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsVUFBQSxHQUFBSCxPQUFBO0FBTUEsSUFBTUksdUJBQXVCLEdBQUcsSUFBQUMsK0JBQWMsR0FBRTtBQUVoRCxJQUFNQyxlQUFlLEdBQUcsSUFBSUMsT0FBTyxFQUdoQztBQUdILElBQU1DLGNBQWMsR0FBR0MsTUFBTSxDQUFDLGdCQUFnQixDQUFDO0FBRS9DLElBQU1DLFNBQVMsR0FBRyxzQkFBc0I7QUFFeEMsU0FBU0MsWUFBWUEsQ0FBQ0MsS0FBMEIsRUFBVztFQUt6RCxPQUFPRixTQUFTLElBQUlFLEtBQUs7QUFDM0I7QUFFTyxTQUFTQyx3QkFBd0JBLENBQ3RDQyxTQUFjLEVB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