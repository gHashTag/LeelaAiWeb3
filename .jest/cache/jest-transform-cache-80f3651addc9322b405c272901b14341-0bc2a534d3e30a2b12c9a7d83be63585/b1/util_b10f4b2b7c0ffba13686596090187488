87f74ec335125fe671d7841a9346a41d
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cancelAnimation = cancelAnimation;
exports.defineAnimation = defineAnimation;
exports.initialUpdaterRun = initialUpdaterRun;
exports.withStartValue = withStartValue;
var _Colors = require("../Colors");
var _NativeReanimated = _interopRequireDefault(require("../NativeReanimated"));
var _matrixUtils = require("./transformationMatrix/matrixUtils");
var IN_STYLE_UPDATER = false;
function initialUpdaterRun(updater) {
  IN_STYLE_UPDATER = true;
  var result = updater();
  IN_STYLE_UPDATER = false;
  return result;
}
function recognizePrefixSuffix(value) {
  'worklet';

  if (typeof value === 'string') {
    var _match$;
    var match = value.match(/([A-Za-z]*)(-?\d*\.?\d*)([eE][-+]?[0-9]+)?([A-Za-z%]*)/);
    if (!match) {
      throw Error("Couldn't parse animation value. Check if there isn't any typo.");
    }
    var prefix = match[1];
    var suffix = match[4];
    var number = match[2] + ((_match$ = match[3]) != null ? _match$ : '');
    return {
      prefix: prefix,
      suffix: suffix,
      strippedValue: parseFloat(number)
    };
  } else {
    return {
      strippedValue: value
    };
  }
}
function applyProgressToMatrix(progress, a, b) {
  'worklet';

  return (0, _matrixUtils.addMatrices)(a, (0, _matrixUtils.scaleMatrix)((0, _matrixUtils.subtractMatrices)(b, a), progress));
}
function applyProgressToNumber(progress, a, b) {
  'worklet';

  return a + progress * (b - a);
}
function decorateAnimation(animation) {
  'worklet';

  if (animation.isHigherOrder) {
    return;
  }
  var baseOnStart = animation.onStart;
  var baseOnFrame = animation.onFrame;
  var animationCopy = Object.assign({}, animation);
  delete animationCopy.callback;
  var prefNumberSuffOnStart = function prefNumberSuffOnStart(animation, value, timestamp, previousAnimation) {
    var _animation$__prefix, _animation$__suffix;
    var _recognizePrefixSuffi = recognizePrefixSuffix(value),
      prefix = _recognizePrefixSuffi.prefix,
      suffix = _recognizePrefixSuffi.suffix,
      strippedValue = _recognizePrefixSuffi.strippedValue;
    animation.__prefix = prefix;
    animation.__suffix = suffix;
    animation.strippedCurrent = strippedValue;
    var _recognizePrefixSuffi2 = recognizePrefixSuffix(animation.toValue),
      strippedToValue = _recognizePrefixSuffi2.strippedValue;
    animation.current = strippedValue;
    animation.startValue = strippedValue;
    animation.toValue = strippedToValue;
    if (previousAnimation && previousAnimation !== animation) {
      var _recognizePrefixSuffi3 = recognizePrefixSuffix(previousAnimation.current),
        paPrefix = _recognizePrefixSuffi3.prefix,
        paSuffix = _recognizePrefixSuffi3.suffix,
        paStrippedValue = _recognizePrefixSuffi3.strippedValue;
      previousAnimation.current = paStrippedValue;
      previousAnimation.__prefix = paPrefix;
      previousAnimation.__suffix = paSuffix;
    }
    baseOnStart(animation, strippedValue, timestamp, previousAnimation);
    animation.current = ((_animation$__prefix = animation.__prefix) != null ? _animation$__prefix : '') + animation.current + ((_animation$__suffix = animation.__suffix) != null ? _animation$__suffix : '');
    if (previousAnimation && previousAnimation !== animation) {
      var _previousAnimation$__, _previousAnimation$__2;
      previousAnimation.current = ((_previousAnimation$__ = previousAnimation.__prefix) != null ? _previousAnimation$__ : '') + previousAnimation.current + ((_previousAnimation$__2 = previousAnimation.__suffix) != null ? _previousAnimation$__2 : '');
    }
  };
  var prefNumberSuffOnFrame = function prefNumberSuffOnFrame(animation, timestamp) {
    var _animation$__prefix2, _animation$__suffix2;
    animation.current = animation.strippedCurrent;
    var res = baseOnFrame(animation, timestamp);
    animation.strippedCurrent = animation.current;
    animation.current = ((_animation$__prefix2 = animation.__prefix) != null ? _animation$__prefix2 : '') + animation.current + ((_animation$__suffix2 = animation.__suffix) != null ? _animation$__suffix2 : '');
    return res;
  };
  var tab = ['R', 'G', 'B', 'A'];
  var colorOnStart = function colorOnStart(animation, value, timestamp, previousAnimation) {
    var RGBAValue;
    var RGBACurrent;
    var RGBAToValue;
    var res = [];
    if ((0, _Colors.isColor)(value)) {
      RGBACurrent = (0, _Colors.toLinearSpace)((0, _Colors.convertToRGBA)(animation.current));
      RGBAValue = (0, _Colors.toLinearSpace)((0, _Colors.convertToRGBA)(value));
      if (animation.toValue) {
        RGBAToValue = (0, _Colors.toLinearSpace)((0, _Colors.convertToRGBA)(animation.toValue));
      }
    }
    tab.forEach(function (i, index) {
      animation[i] = Object.assign({}, animationCopy);
      animation[i].current = RGBACurrent[index];
      animation[i].toValue = RGBAToValue ? RGBAToValue[index] : undefined;
      animation[i].onStart(animation[i], RGBAValue[index], timestamp, previousAnimation ? previousAnimation[i] : undefined);
      res.push(animation[i].current);
    });
    animation.current = (0, _Colors.rgbaArrayToRGBAColor)((0, _Colors.toGammaSpace)(res));
  };
  var colorOnFrame = function colorOnFrame(animation, timestamp) {
    var RGBACurrent = (0, _Colors.toLinearSpace)((0, _Colors.convertToRGBA)(animation.current));
    var res = [];
    var finished = true;
    tab.forEach(function (i, index) {
      animation[i].current = RGBACurrent[index];
      var result = animation[i].onFrame(animation[i], timestamp);
      finished &&= result;
      res.push(animation[i].current);
    });
    animation.current = (0, _Colors.rgbaArrayToRGBAColor)((0, _Colors.toGammaSpace)(res));
    return finished;
  };
  var transformationMatrixOnStart = function transformationMatrixOnStart(animation, value, timestamp, previousAnimation) {
    var toValue = animation.toValue;
    animation.startMatrices = (0, _matrixUtils.decomposeMatrixIntoMatricesAndAngles)(value);
    animation.stopMatrices = (0, _matrixUtils.decomposeMatrixIntoMatricesAndAngles)(toValue);
    animation[0] = Object.assign({}, animationCopy);
    animation[0].current = 0;
    animation[0].toValue = 100;
    animation[0].onStart(animation[0], 0, timestamp, previousAnimation ? previousAnimation[0] : undefined);
    animation.current = value;
  };
  var transformationMatrixOnFrame = function transformationMatrixOnFrame(animation, timestamp) {
    var finished = true;
    var result = animation[0].onFrame(animation[0], timestamp);
    finished &&= result;
    var progress = animation[0].current / 100;
    var transforms = ['translationMatrix', 'scaleMatrix', 'skewMatrix'];
    var mappedTransforms = [];
    transforms.forEach(function (key, _) {
      return mappedTransforms.push(applyProgressToMatrix(progress, animation.startMatrices[key], animation.stopMatrices[key]));
    });
    var currentTranslation = mappedTransforms[0],
      currentScale = mappedTransforms[1],
      skewMatrix = mappedTransforms[2];
    var rotations = ['x', 'y', 'z'];
    var mappedRotations = [];
    rotations.forEach(function (key, _) {
      var angle = applyProgressToNumber(progress, animation.startMatrices['r' + key], animation.stopMatrices['r' + key]);
      mappedRotations.push((0, _matrixUtils.getRotationMatrix)(angle, key));
    });
    var rotationMatrixX = mappedRotations[0],
      rotationMatrixY = mappedRotations[1],
      rotationMatrixZ = mappedRotations[2];
    var rotationMatrix = (0, _matrixUtils.multiplyMatrices)(rotationMatrixX, (0, _matrixUtils.multiplyMatrices)(rotationMatrixY, rotationMatrixZ));
    var updated = (0, _matrixUtils.flatten)((0, _matrixUtils.multiplyMatrices)((0, _matrixUtils.multiplyMatrices)(currentScale, (0, _matrixUtils.multiplyMatrices)(skewMatrix, rotationMatrix)), currentTranslation));
    animation.current = updated;
    return finished;
  };
  var arrayOnStart = function arrayOnStart(animation, value, timestamp, previousAnimation) {
    value.forEach(function (v, i) {
      animation[i] = Object.assign({}, animationCopy);
      animation[i].current = v;
      animation[i].toValue = animation.toValue[i];
      animation[i].onStart(animation[i], v, timestamp, previousAnimation ? previousAnimation[i] : undefined);
    });
    animation.current = value;
  };
  var arrayOnFrame = function arrayOnFrame(animation, timestamp) {
    var finished = true;
    animation.current.forEach(function (_, i) {
      var result = animation[i].onFrame(animation[i], timestamp);
      finished &&= result;
      animation.current[i] = animation[i].current;
    });
    return finished;
  };
  var objectOnStart = function objectOnStart(animation, value, timestamp, previousAnimation) {
    for (var key in value) {
      animation[key] = Object.assign({}, animationCopy);
      animation[key].onStart = animation.onStart;
      animation[key].current = value[key];
      animation[key].toValue = animation.toValue[key];
      animation[key].onStart(animation[key], value[key], timestamp, previousAnimation ? previousAnimation[key] : undefined);
    }
    animation.current = value;
  };
  var objectOnFrame = function objectOnFrame(animation, timestamp) {
    var finished = true;
    var newObject = {};
    for (var key in animation.current) {
      var result = animation[key].onFrame(animation[key], timestamp);
      finished &&= result;
      newObject[key] = animation[key].current;
    }
    animation.current = newObject;
    return finished;
  };
  animation.onStart = function (animation, value, timestamp, previousAnimation) {
    if ((0, _Colors.isColor)(value)) {
      colorOnStart(animation, value, timestamp, previousAnimation);
      animation.onFrame = colorOnFrame;
      return;
    } else if ((0, _matrixUtils.isAffineMatrixFlat)(value)) {
      transformationMatrixOnStart(animation, value, timestamp, previousAnimation);
      animation.onFrame = transformationMatrixOnFrame;
      return;
    } else if (Array.isArray(value)) {
      arrayOnStart(animation, value, timestamp, previousAnimation);
      animation.onFrame = arrayOnFrame;
      return;
    } else if (typeof value === 'string') {
      prefNumberSuffOnStart(animation, value, timestamp, previousAnimation);
      animation.onFrame = prefNumberSuffOnFrame;
      return;
    } else if (typeof value === 'object' && value !== null) {
      objectOnStart(animation, value, timestamp, previousAnimation);
      animation.onFrame = objectOnFrame;
      return;
    }
    baseOnStart(animation, value, timestamp, previousAnimation);
  };
}
var IS_NATIVE = _NativeReanimated.default.native;
function defineAnimation(starting, factory) {
  'worklet';

  if (IN_STYLE_UPDATER) {
    return starting;
  }
  var create = function create() {
    'worklet';

    var animation = factory();
    decorateAnimation(animation);
    return animation;
  };
  if (_WORKLET || !IS_NATIVE) {
    return create();
  }
  return create;
}
function cancelAnimation(sharedValue) {
  'worklet';
  sharedValue.value = sharedValue.value;
}
function withStartValue(startValue, animation) {
  'worklet';

  return defineAnimation(startValue, function () {
    'worklet';

    if (!_WORKLET && typeof animation === 'function') {
      animation = animation();
    }
    animation.current = startValue;
    return animation;
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfQ29sb3JzIiwicmVxdWlyZSIsIl9OYXRpdmVSZWFuaW1hdGVkIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9tYXRyaXhVdGlscyIsIklOX1NUWUxFX1VQREFURVIiLCJpbml0aWFsVXBkYXRlclJ1biIsInVwZGF0ZXIiLCJyZXN1bHQiLCJyZWNvZ25pemVQcmVmaXhTdWZmaXgiLCJ2YWx1ZSIsIl9tYXRjaCQiLCJtYXRjaCIsIkVycm9yIiwicHJlZml4Iiwic3VmZml4IiwibnVtYmVyIiwic3RyaXBwZWRWYWx1ZSIsInBhcnNlRmxvYXQiLCJhcHBseVByb2dyZXNzVG9NYXRyaXgiLCJwcm9ncmVzcyIsImEiLCJiIiwiYWRkTWF0cmljZXMiLCJzY2FsZU1hdHJpeCIsInN1YnRyYWN0TWF0cmljZXMiLCJhcHBseVByb2dyZXNzVG9OdW1iZXIiLCJkZWNvcmF0ZUFuaW1hdGlvbiIsImFuaW1hdGlvbiIsImlzSGlnaGVyT3JkZXIiLCJiYXNlT25TdGFydCIsIm9uU3RhcnQiLCJiYXNlT25GcmFtZSIsIm9uRnJhbWUiLCJhbmltYXRpb25Db3B5IiwiT2JqZWN0IiwiYXNzaWduIiwiY2FsbGJhY2siLCJwcmVmTnVtYmVyU3VmZk9uU3RhcnQiLCJ0aW1lc3RhbXAiLCJwcmV2aW91c0FuaW1hdGlvbiIsIl9hbmltYXRpb24kX19wcmVmaXgiLCJfYW5pbWF0aW9uJF9fc3VmZml4IiwiX3JlY29nbml6ZVByZWZpeFN1ZmZpIiwiX19wcmVmaXgiLCJfX3N1ZmZpeCIsInN0cmlwcGVkQ3VycmVudCIsIl9yZWNvZ25pemVQcmVmaXhTdWZmaTIiLCJ0b1ZhbHVlIiwic3RyaXBwZWRUb1ZhbHVlIiwiY3VycmVudCIsInN0YXJ0VmFsdWUiLCJfcmVjb2duaXplUHJlZml4U3VmZmkzIiwicGFQcmVmaXgiLCJwYVN1ZmZpeCIsInBhU3RyaXBwZWRWYWx1ZSIsIl9wcmV2aW91c0FuaW1hdGlvbiRfXyIsIl9wcmV2aW91c0FuaW1hdGlvbiRfXzIiLCJwcmVmTnVtYmVyU3VmZk9uRnJhbWUiLCJfYW5pbWF0aW9uJF9fcHJlZml4MiIsIl9hbmltYXRpb24kX19zdWZmaXgyIiwicmVzIiwidGFiIiwiY29sb3JPblN0YXJ0IiwiUkdCQVZhbHVlIiwiUkdCQUN1cnJlbnQiLCJSR0JBVG9WYWx1ZSIsImlzQ29sb3IiLCJ0b0xpbmVhclNwYWNlIiwiY29udmVydFRvUkdCQSIsImZvckVhY2giLCJpIiwiaW5kZXgiLCJ1bmRlZmluZWQiLCJwdXNoIiwicmdiYUFycmF5VG9SR0JBQ29sb3IiLCJ0b0dhbW1hU3BhY2UiLCJjb2xvck9uRnJhbWUiLCJmaW5pc2hlZCIsInRyYW5zZm9ybWF0aW9uTWF0cml4T25TdGFydCIsInN0YXJ0TWF0cmljZXMiLCJkZWNvbXBvc2VNYXRyaXhJbnRvTWF0cmljZXNBbmRBbmdsZXMiLCJzdG9wTWF0cmljZXMiLCJ0cmFuc2Zvcm1hdGlvbk1hdHJpeE9uRnJhbWUiLCJ0cmFuc2Zvcm1zIiwibWFwcGVkVHJhbnNmb3JtcyIsImtleSIsIl8iLCJjdXJyZW50VHJhbnNsYXRpb24iLCJjdXJyZW50U2NhbGUiLCJza2V3TWF0cml4Iiwicm90YXRpb25zIiwibWFwcGVkUm90YXRpb25zIiwiYW5nbGUiLCJnZXRSb3RhdGlvbk1hdHJpeCIsInJvdGF0aW9uTWF0cml4WCIsInJvdGF0aW9uTWF0cml4WSIsInJvdGF0aW9uTWF0cml4WiIsInJvdGF0aW9uTWF0cml4IiwibXVsdGlwbHlNYXRyaWNlcyIsInVwZGF0ZWQiLCJmbGF0dGVuIiwiYXJyYXlPblN0YXJ0IiwidiIsImFycmF5T25GcmFtZSIsIm9iamVjdE9uU3RhcnQiLCJvYmplY3RPbkZyYW1lIiwibmV3T2JqZWN0IiwiaXNBZmZpbmVNYXRyaXhGbGF0IiwiQXJyYXkiLCJpc0FycmF5IiwiSVNfTkFUSVZFIiwiTmF0aXZlUmVhbmltYXRlZE1vZHVsZSIsIm5hdGl2ZSIsImRlZmluZUFuaW1hdGlvbiIsInN0YXJ0aW5nIiwiZmFjdG9yeSIsImNyZWF0ZSIsIl9XT1JLTEVUIiwiY2FuY2VsQW5pbWF0aW9uIiwic2hhcmVkVmFsdWUiLCJ3aXRoU3RhcnRWYWx1ZSJdLCJzb3VyY2VzIjpbInV0aWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge1xuICBIaWdoZXJPcmRlckFuaW1hdGlvbixcbiAgTmV4dEFuaW1hdGlvbixcbiAgU3R5bGVMYXlvdXRBbmltYXRpb24sXG59IGZyb20gJy4vY29tbW9uVHlwZXMnO1xuaW1wb3J0IHR5cGUgeyBQYXJzZWRDb2xvckFycmF5IH0gZnJvbSAnLi4vQ29sb3JzJztcbmltcG9ydCB7XG4gIGlzQ29sb3IsXG4gIGNvbnZlcnRUb1JHQkEsXG4gIHJnYmFBcnJheVRvUkdCQUNvbG9yLFxuICB0b0dhbW1hU3BhY2UsXG4gIHRvTGluZWFyU3BhY2UsXG59IGZyb20gJy4uL0NvbG9ycyc7XG5cbmltcG9ydCB0eXBlIHtcbiAgQW5pbWF0ZWRTdHlsZSxcbiAgU2hhcmVkVmFsdWUsXG4gIEFuaW1hdGFibGVWYWx1ZSxcbiAgQW5pbWF0aW9uLFxuICBBbmltYXRpb25PYmplY3QsXG4gIFRpbWVzdGFtcCxcbiAgQW5pbWF0YWJsZVZhbHVlT2JqZWN0LFxufSBmcm9tICcuLi9jb21tb25UeXBlcyc7XG5pbXBvcnQgTmF0aXZlUmVhbmltYXRlZE1vZHVsZSBmcm9tICcuLi9OYXRpdmVSZWFuaW1hdGVkJztcbmltcG9ydCB7XG4gIEFmZmluZU1hdHJpeEZsYXQsXG4gIEFmZmluZU1hdHJpeCxcbiAgZmxhdHRlbixcbiAgbXVsdGlwbHlNYXRyaWNlcyxcbiAgc2NhbGVNYXRyaXgsXG4gIGFkZE1hdHJpY2VzLFxuICBkZWNvbXBvc2VNYXRyaXhJbnRvTWF0cmljZXNBbmRBbmdsZXMsXG4gIGlzQWZmaW5lTWF0cml4RmxhdCxcbiAgc3VidHJhY3RNYXRyaWNlcyxcbiAgZ2V0Um90YXRpb25NYXRyaXgsXG59IGZyb20gJy4vdHJhbnNmb3JtYXRpb25NYXRyaXgvbWF0cml4VXRpbHMnO1xuXG5sZXQgSU5fU1RZTEVfVVBEQVRFUiA9IGZhbHNlO1xuXG5leHBvcnQgdHlwZSBVc2VyVXBkYXRlciA9ICgpID0+IEFuaW1hdGVkU3R5bGU7XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsVXBkYXRlclJ1bjxUPih1cGRhdGVyOiAoKSA9PiBUKTogVCB7XG4gIElOX1NUWUxFX1VQREFURVIgPSB0cnVlO1xuICBjb25zdCByZXN1bHQgPSB1cGRhdGVyKCk7XG4gIElOX1NUWUxFX1VQREFURVIgPSBmYWxzZTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuaW50ZXJmYWNlIFJlY29nbml6ZWRQcmVmaXhTdWZmaXgge1xuICBwcmVmaXg/OiBzdHJpbmc7XG4gIHN1ZmZpeD86IHN0cmluZztcbiAgc3RyaXBwZWRWYWx1ZTogbnVtYmVyO1xufVxuXG5mdW5jdGlvbiByZWNvZ25pemVQcmVmaXhTdWZmaXgodmFsdWU6IHN0cmluZyB8IG51bWJlcik6IFJlY29nbml6ZWRQcmVmaXhTdWZmaXgge1xuICAnd29ya2xldCc7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgY29uc3QgbWF0Y2ggPSB2YWx1ZS5tYXRjaChcbiAgICAgIC8oW0EtWmEtel0qKSgtP1xcZCpcXC4/XFxkKikoW2VFXVstK10/WzAtOV0rKT8oW0EtWmEteiVdKikvXG4gICAgKTtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgXCJDb3VsZG4ndCBwYXJzZSBhbmltYXRpb24gdmFsdWUuIENoZWNrIGlmIHRoZXJlIGlzbid0IGFueSB0eXBvLlwiXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBwcmVmaXggPSBtYXRjaFsxXTtcbiAgICBjb25zdCBzdWZmaXggPSBtYXRjaFs0XTtcbiAgICAvLyBudW1iZXIgd2l0aCBzY2llbnRpZmljIG5vdGF0aW9uXG4gICAgY29uc3QgbnVtYmVyID0gbWF0Y2hbMl0gKyAobWF0Y2hbM10gPz8gJycpO1xuICAgIHJldHVybiB7IHByZWZpeCwgc3VmZml4LCBzdHJpcHBlZFZhbHVlOiBwYXJzZUZsb2F0KG51bWJlcikgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4geyBzdHJpcHBlZFZhbHVlOiB2YWx1ZSB9O1xuICB9XG59XG5cbmZ1bmN0aW9uIGFwcGx5UHJvZ3Jlc3NUb01hdHJpeChcbiAgcHJvZ3Jlc3M6IG51bWJlcixcbiAgYTogQWZmaW5lTWF0cml4LFxuICBiOiBBZmZpbmVNYXRyaXhcbikge1xuICAnd29ya2xldCc7XG4gIHJldHVybiBhZGRNYXRyaWNlcyhhLCBzY2FsZU1hdHJpeChzdWJ0cmFjdE1hdHJpY2VzKGIsIGEpLCBwcm9ncmVzcykpO1xufVxuXG5mdW5jdGlvbiBhcHBseVByb2dyZXNzVG9OdW1iZXIocHJvZ3Jlc3M6IG51bWJlciwgYTogbnVtYmVyLCBiOiBudW1iZXIpIHtcbiAgJ3dvcmtsZXQnO1xuICByZXR1cm4gYSArIHByb2dyZXNzICogKGIgLSBhKTtcbn1cblxuZnVuY3Rpb24gZGVjb3JhdGVBbmltYXRpb248VCBleHRlbmRzIEFuaW1hdGlvbk9iamVjdCB8IFN0eWxlTGF5b3V0QW5pbWF0aW9uPihcbiAgYW5pbWF0aW9uOiBUXG4pOiB2b2lkIHtcbiAgJ3dvcmtsZXQnO1xuICBpZiAoKGFuaW1hdGlvbiBhcyBIaWdoZXJPcmRlckFuaW1hdGlvbikuaXNIaWdoZXJPcmRlcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGJhc2VPblN0YXJ0ID0gKGFuaW1hdGlvbiBhcyBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0Pikub25TdGFydDtcbiAgY29uc3QgYmFzZU9uRnJhbWUgPSAoYW5pbWF0aW9uIGFzIEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+KS5vbkZyYW1lO1xuICBjb25zdCBhbmltYXRpb25Db3B5ID0gT2JqZWN0LmFzc2lnbih7fSwgYW5pbWF0aW9uKTtcbiAgZGVsZXRlIGFuaW1hdGlvbkNvcHkuY2FsbGJhY2s7XG5cbiAgY29uc3QgcHJlZk51bWJlclN1ZmZPblN0YXJ0ID0gKFxuICAgIGFuaW1hdGlvbjogQW5pbWF0aW9uPEFuaW1hdGlvbk9iamVjdD4sXG4gICAgdmFsdWU6IHN0cmluZyB8IG51bWJlcixcbiAgICB0aW1lc3RhbXA6IG51bWJlcixcbiAgICBwcmV2aW91c0FuaW1hdGlvbjogQW5pbWF0aW9uPEFuaW1hdGlvbk9iamVjdD5cbiAgKSA9PiB7XG4gICAgLy8gcmVjb2duaXplIHByZWZpeCwgc3VmZml4LCBhbmQgdXBkYXRlcyBzdHJpcHBlZCB2YWx1ZSBvbiBhbmltYXRpb24gc3RhcnRcbiAgICBjb25zdCB7IHByZWZpeCwgc3VmZml4LCBzdHJpcHBlZFZhbHVlIH0gPSByZWNvZ25pemVQcmVmaXhTdWZmaXgodmFsdWUpO1xuICAgIGFuaW1hdGlvbi5fX3ByZWZpeCA9IHByZWZpeDtcbiAgICBhbmltYXRpb24uX19zdWZmaXggPSBzdWZmaXg7XG4gICAgYW5pbWF0aW9uLnN0cmlwcGVkQ3VycmVudCA9IHN0cmlwcGVkVmFsdWU7XG4gICAgY29uc3QgeyBzdHJpcHBlZFZhbHVlOiBzdHJpcHBlZFRvVmFsdWUgfSA9IHJlY29nbml6ZVByZWZpeFN1ZmZpeChcbiAgICAgIGFuaW1hdGlvbi50b1ZhbHVlIGFzIHN0cmluZyB8IG51bWJlclxuICAgICk7XG4gICAgYW5pbWF0aW9uLmN1cnJlbnQgPSBzdHJpcHBlZFZhbHVlO1xuICAgIGFuaW1hdGlvbi5zdGFydFZhbHVlID0gc3RyaXBwZWRWYWx1ZTtcbiAgICBhbmltYXRpb24udG9WYWx1ZSA9IHN0cmlwcGVkVG9WYWx1ZTtcbiAgICBpZiAocHJldmlvdXNBbmltYXRpb24gJiYgcHJldmlvdXNBbmltYXRpb24gIT09IGFuaW1hdGlvbikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBwcmVmaXg6IHBhUHJlZml4LFxuICAgICAgICBzdWZmaXg6IHBhU3VmZml4LFxuICAgICAgICBzdHJpcHBlZFZhbHVlOiBwYVN0cmlwcGVkVmFsdWUsXG4gICAgICB9ID0gcmVjb2duaXplUHJlZml4U3VmZml4KHByZXZpb3VzQW5pbWF0aW9uLmN1cnJlbnQgYXMgc3RyaW5nIHwgbnVtYmVyKTtcbiAgICAgIHByZXZpb3VzQW5pbWF0aW9uLmN1cnJlbnQgPSBwYVN0cmlwcGVkVmFsdWU7XG4gICAgICBwcmV2aW91c0FuaW1hdGlvbi5fX3ByZWZpeCA9IHBhUHJlZml4O1xuICAgICAgcHJldmlvdXNBbmltYXRpb24uX19zdWZmaXggPSBwYVN1ZmZpeDtcbiAgICB9XG5cbiAgICBiYXNlT25TdGFydChhbmltYXRpb24sIHN0cmlwcGVkVmFsdWUsIHRpbWVzdGFtcCwgcHJldmlvdXNBbmltYXRpb24pO1xuXG4gICAgYW5pbWF0aW9uLmN1cnJlbnQgPVxuICAgICAgKGFuaW1hdGlvbi5fX3ByZWZpeCA/PyAnJykgK1xuICAgICAgYW5pbWF0aW9uLmN1cnJlbnQgK1xuICAgICAgKGFuaW1hdGlvbi5fX3N1ZmZpeCA/PyAnJyk7XG5cbiAgICBpZiAocHJldmlvdXNBbmltYXRpb24gJiYgcHJldmlvdXNBbmltYXRpb24gIT09IGFuaW1hdGlvbikge1xuICAgICAgcHJldmlvdXNBbmltYXRpb24uY3VycmVudCA9XG4gICAgICAgIChwcmV2aW91c0FuaW1hdGlvbi5fX3ByZWZpeCA/PyAnJykgK1xuICAgICAgICBwcmV2aW91c0FuaW1hdGlvbi5jdXJyZW50ICtcbiAgICAgICAgKHByZXZpb3VzQW5pbWF0aW9uLl9fc3VmZml4ID8/ICcnKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHByZWZOdW1iZXJTdWZmT25GcmFtZSA9IChcbiAgICBhbmltYXRpb246IEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+LFxuICAgIHRpbWVzdGFtcDogbnVtYmVyXG4gICkgPT4ge1xuICAgIGFuaW1hdGlvbi5jdXJyZW50ID0gYW5pbWF0aW9uLnN0cmlwcGVkQ3VycmVudDtcbiAgICBjb25zdCByZXMgPSBiYXNlT25GcmFtZShhbmltYXRpb24sIHRpbWVzdGFtcCk7XG4gICAgYW5pbWF0aW9uLnN0cmlwcGVkQ3VycmVudCA9IGFuaW1hdGlvbi5jdXJyZW50O1xuICAgIGFuaW1hdGlvbi5jdXJyZW50ID1cbiAgICAgIChhbmltYXRpb24uX19wcmVmaXggPz8gJycpICtcbiAgICAgIGFuaW1hdGlvbi5jdXJyZW50ICtcbiAgICAgIChhbmltYXRpb24uX19zdWZmaXggPz8gJycpO1xuICAgIHJldHVybiByZXM7XG4gIH07XG5cbiAgY29uc3QgdGFiID0gWydSJywgJ0cnLCAnQicsICdBJ107XG4gIGNvbnN0IGNvbG9yT25TdGFydCA9IChcbiAgICBhbmltYXRpb246IEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+LFxuICAgIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIsXG4gICAgdGltZXN0YW1wOiBUaW1lc3RhbXAsXG4gICAgcHJldmlvdXNBbmltYXRpb246IEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+XG4gICk6IHZvaWQgPT4ge1xuICAgIGxldCBSR0JBVmFsdWU6IFBhcnNlZENvbG9yQXJyYXk7XG4gICAgbGV0IFJHQkFDdXJyZW50OiBQYXJzZWRDb2xvckFycmF5O1xuICAgIGxldCBSR0JBVG9WYWx1ZTogUGFyc2VkQ29sb3JBcnJheTtcbiAgICBjb25zdCByZXM6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgICBpZiAoaXNDb2xvcih2YWx1ZSkpIHtcbiAgICAgIFJHQkFDdXJyZW50ID0gdG9MaW5lYXJTcGFjZShjb252ZXJ0VG9SR0JBKGFuaW1hdGlvbi5jdXJyZW50KSk7XG4gICAgICBSR0JBVmFsdWUgPSB0b0xpbmVhclNwYWNlKGNvbnZlcnRUb1JHQkEodmFsdWUpKTtcbiAgICAgIGlmIChhbmltYXRpb24udG9WYWx1ZSkge1xuICAgICAgICBSR0JBVG9WYWx1ZSA9IHRvTGluZWFyU3BhY2UoY29udmVydFRvUkdCQShhbmltYXRpb24udG9WYWx1ZSkpO1xuICAgICAgfVxuICAgIH1cbiAgICB0YWIuZm9yRWFjaCgoaSwgaW5kZXgpID0+IHtcbiAgICAgIGFuaW1hdGlvbltpXSA9IE9iamVjdC5hc3NpZ24oe30sIGFuaW1hdGlvbkNvcHkpO1xuICAgICAgYW5pbWF0aW9uW2ldLmN1cnJlbnQgPSBSR0JBQ3VycmVudFtpbmRleF07XG4gICAgICBhbmltYXRpb25baV0udG9WYWx1ZSA9IFJHQkFUb1ZhbHVlID8gUkdCQVRvVmFsdWVbaW5kZXhdIDogdW5kZWZpbmVkO1xuICAgICAgYW5pbWF0aW9uW2ldLm9uU3RhcnQoXG4gICAgICAgIGFuaW1hdGlvbltpXSxcbiAgICAgICAgUkdCQVZhbHVlW2luZGV4XSxcbiAgICAgICAgdGltZXN0YW1wLFxuICAgICAgICBwcmV2aW91c0FuaW1hdGlvbiA/IHByZXZpb3VzQW5pbWF0aW9uW2ldIDogdW5kZWZpbmVkXG4gICAgICApO1xuICAgICAgcmVzLnB1c2goYW5pbWF0aW9uW2ldLmN1cnJlbnQpO1xuICAgIH0pO1xuXG4gICAgYW5pbWF0aW9uLmN1cnJlbnQgPSByZ2JhQXJyYXlUb1JHQkFDb2xvcihcbiAgICAgIHRvR2FtbWFTcGFjZShyZXMgYXMgUGFyc2VkQ29sb3JBcnJheSlcbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IGNvbG9yT25GcmFtZSA9IChcbiAgICBhbmltYXRpb246IEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+LFxuICAgIHRpbWVzdGFtcDogVGltZXN0YW1wXG4gICk6IGJvb2xlYW4gPT4ge1xuICAgIGNvbnN0IFJHQkFDdXJyZW50ID0gdG9MaW5lYXJTcGFjZShjb252ZXJ0VG9SR0JBKGFuaW1hdGlvbi5jdXJyZW50KSk7XG4gICAgY29uc3QgcmVzOiBBcnJheTxudW1iZXI+ID0gW107XG4gICAgbGV0IGZpbmlzaGVkID0gdHJ1ZTtcbiAgICB0YWIuZm9yRWFjaCgoaSwgaW5kZXgpID0+IHtcbiAgICAgIGFuaW1hdGlvbltpXS5jdXJyZW50ID0gUkdCQUN1cnJlbnRbaW5kZXhdO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYW5pbWF0aW9uW2ldLm9uRnJhbWUoYW5pbWF0aW9uW2ldLCB0aW1lc3RhbXApO1xuICAgICAgLy8gV2UgcmVhbGx5IG5lZWQgdG8gYXNzaWduIHRoaXMgdmFsdWUgdG8gcmVzdWx0LCBpbnN0ZWFkIG9mIHBhc3NpbmcgaXQgZGlyZWN0bHkgLSBvdGhlcndpc2Ugb25jZSBcImZpbmlzaGVkXCIgaXMgZmFsc2UsIG9uRnJhbWUgd29uJ3QgYmUgY2FsbGVkXG4gICAgICBmaW5pc2hlZCAmJj0gcmVzdWx0O1xuICAgICAgcmVzLnB1c2goYW5pbWF0aW9uW2ldLmN1cnJlbnQpO1xuICAgIH0pO1xuXG4gICAgYW5pbWF0aW9uLmN1cnJlbnQgPSByZ2JhQXJyYXlUb1JHQkFDb2xvcihcbiAgICAgIHRvR2FtbWFTcGFjZShyZXMgYXMgUGFyc2VkQ29sb3JBcnJheSlcbiAgICApO1xuICAgIHJldHVybiBmaW5pc2hlZDtcbiAgfTtcblxuICBjb25zdCB0cmFuc2Zvcm1hdGlvbk1hdHJpeE9uU3RhcnQgPSAoXG4gICAgYW5pbWF0aW9uOiBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PixcbiAgICB2YWx1ZTogQWZmaW5lTWF0cml4RmxhdCxcbiAgICB0aW1lc3RhbXA6IFRpbWVzdGFtcCxcbiAgICBwcmV2aW91c0FuaW1hdGlvbjogQW5pbWF0aW9uPEFuaW1hdGlvbk9iamVjdD5cbiAgKTogdm9pZCA9PiB7XG4gICAgY29uc3QgdG9WYWx1ZSA9IGFuaW1hdGlvbi50b1ZhbHVlIGFzIEFmZmluZU1hdHJpeEZsYXQ7XG5cbiAgICBhbmltYXRpb24uc3RhcnRNYXRyaWNlcyA9IGRlY29tcG9zZU1hdHJpeEludG9NYXRyaWNlc0FuZEFuZ2xlcyh2YWx1ZSk7XG4gICAgYW5pbWF0aW9uLnN0b3BNYXRyaWNlcyA9IGRlY29tcG9zZU1hdHJpeEludG9NYXRyaWNlc0FuZEFuZ2xlcyh0b1ZhbHVlKTtcblxuICAgIC8vIFdlIGNyZWF0ZSBhbiBhbmltYXRpb24gY29weSB0byBhbmltYXRlIHNpbmdsZSB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDEwMFxuICAgIC8vIFdlIHNldCBsaW1pdHMgZnJvbSAwIHRvIDEwMCAoaW5zdGVhZCBvZiAwLTEpIHRvIG1ha2Ugc3ByaW5nIGxvb2sgZ29vZFxuICAgIC8vIHdpdGggZGVmYXVsdCB0aHJlc2hvbGRzLlxuXG4gICAgYW5pbWF0aW9uWzBdID0gT2JqZWN0LmFzc2lnbih7fSwgYW5pbWF0aW9uQ29weSk7XG4gICAgYW5pbWF0aW9uWzBdLmN1cnJlbnQgPSAwO1xuICAgIGFuaW1hdGlvblswXS50b1ZhbHVlID0gMTAwO1xuICAgIGFuaW1hdGlvblswXS5vblN0YXJ0KFxuICAgICAgYW5pbWF0aW9uWzBdLFxuICAgICAgMCxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIHByZXZpb3VzQW5pbWF0aW9uID8gcHJldmlvdXNBbmltYXRpb25bMF0gOiB1bmRlZmluZWRcbiAgICApO1xuXG4gICAgYW5pbWF0aW9uLmN1cnJlbnQgPSB2YWx1ZTtcbiAgfTtcblxuICBjb25zdCB0cmFuc2Zvcm1hdGlvbk1hdHJpeE9uRnJhbWUgPSAoXG4gICAgYW5pbWF0aW9uOiBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PixcbiAgICB0aW1lc3RhbXA6IFRpbWVzdGFtcFxuICApOiBib29sZWFuID0+IHtcbiAgICBsZXQgZmluaXNoZWQgPSB0cnVlO1xuICAgIGNvbnN0IHJlc3VsdCA9IGFuaW1hdGlvblswXS5vbkZyYW1lKGFuaW1hdGlvblswXSwgdGltZXN0YW1wKTtcbiAgICAvLyBXZSByZWFsbHkgbmVlZCB0byBhc3NpZ24gdGhpcyB2YWx1ZSB0byByZXN1bHQsIGluc3RlYWQgb2YgcGFzc2luZyBpdCBkaXJlY3RseSAtIG90aGVyd2lzZSBvbmNlIFwiZmluaXNoZWRcIiBpcyBmYWxzZSwgb25GcmFtZSB3b24ndCBiZSBjYWxsZWRcbiAgICBmaW5pc2hlZCAmJj0gcmVzdWx0O1xuXG4gICAgY29uc3QgcHJvZ3Jlc3MgPSBhbmltYXRpb25bMF0uY3VycmVudCAvIDEwMDtcblxuICAgIGNvbnN0IHRyYW5zZm9ybXMgPSBbJ3RyYW5zbGF0aW9uTWF0cml4JywgJ3NjYWxlTWF0cml4JywgJ3NrZXdNYXRyaXgnXTtcbiAgICBjb25zdCBtYXBwZWRUcmFuc2Zvcm1zOiBBcnJheTxBZmZpbmVNYXRyaXg+ID0gW107XG5cbiAgICB0cmFuc2Zvcm1zLmZvckVhY2goKGtleSwgXykgPT5cbiAgICAgIG1hcHBlZFRyYW5zZm9ybXMucHVzaChcbiAgICAgICAgYXBwbHlQcm9ncmVzc1RvTWF0cml4KFxuICAgICAgICAgIHByb2dyZXNzLFxuICAgICAgICAgIGFuaW1hdGlvbi5zdGFydE1hdHJpY2VzW2tleV0sXG4gICAgICAgICAgYW5pbWF0aW9uLnN0b3BNYXRyaWNlc1trZXldXG4gICAgICAgIClcbiAgICAgIClcbiAgICApO1xuXG4gICAgY29uc3QgW2N1cnJlbnRUcmFuc2xhdGlvbiwgY3VycmVudFNjYWxlLCBza2V3TWF0cml4XSA9IG1hcHBlZFRyYW5zZm9ybXM7XG5cbiAgICBjb25zdCByb3RhdGlvbnM6IEFycmF5PCd4JyB8ICd5JyB8ICd6Jz4gPSBbJ3gnLCAneScsICd6J107XG4gICAgY29uc3QgbWFwcGVkUm90YXRpb25zOiBBcnJheTxBZmZpbmVNYXRyaXg+ID0gW107XG5cbiAgICByb3RhdGlvbnMuZm9yRWFjaCgoa2V5LCBfKSA9PiB7XG4gICAgICBjb25zdCBhbmdsZSA9IGFwcGx5UHJvZ3Jlc3NUb051bWJlcihcbiAgICAgICAgcHJvZ3Jlc3MsXG4gICAgICAgIGFuaW1hdGlvbi5zdGFydE1hdHJpY2VzWydyJyArIGtleV0sXG4gICAgICAgIGFuaW1hdGlvbi5zdG9wTWF0cmljZXNbJ3InICsga2V5XVxuICAgICAgKTtcbiAgICAgIG1hcHBlZFJvdGF0aW9ucy5wdXNoKGdldFJvdGF0aW9uTWF0cml4KGFuZ2xlLCBrZXkpKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IFtyb3RhdGlvbk1hdHJpeFgsIHJvdGF0aW9uTWF0cml4WSwgcm90YXRpb25NYXRyaXhaXSA9IG1hcHBlZFJvdGF0aW9ucztcblxuICAgIGNvbnN0IHJvdGF0aW9uTWF0cml4ID0gbXVsdGlwbHlNYXRyaWNlcyhcbiAgICAgIHJvdGF0aW9uTWF0cml4WCxcbiAgICAgIG11bHRpcGx5TWF0cmljZXMocm90YXRpb25NYXRyaXhZLCByb3RhdGlvbk1hdHJpeFopXG4gICAgKTtcblxuICAgIGNvbnN0IHVwZGF0ZWQgPSBmbGF0dGVuKFxuICAgICAgbXVsdGlwbHlNYXRyaWNlcyhcbiAgICAgICAgbXVsdGlwbHlNYXRyaWNlcyhcbiAgICAgICAgICBjdXJyZW50U2NhbGUsXG4gICAgICAgICAgbXVsdGlwbHlNYXRyaWNlcyhza2V3TWF0cml4LCByb3RhdGlvbk1hdHJpeClcbiAgICAgICAgKSxcbiAgICAgICAgY3VycmVudFRyYW5zbGF0aW9uXG4gICAgICApXG4gICAgKTtcblxuICAgIGFuaW1hdGlvbi5jdXJyZW50ID0gdXBkYXRlZDtcblxuICAgIHJldHVybiBmaW5pc2hlZDtcbiAgfTtcblxuICBjb25zdCBhcnJheU9uU3RhcnQgPSAoXG4gICAgYW5pbWF0aW9uOiBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PixcbiAgICB2YWx1ZTogQXJyYXk8bnVtYmVyPixcbiAgICB0aW1lc3RhbXA6IFRpbWVzdGFtcCxcbiAgICBwcmV2aW91c0FuaW1hdGlvbjogQW5pbWF0aW9uPEFuaW1hdGlvbk9iamVjdD5cbiAgKTogdm9pZCA9PiB7XG4gICAgdmFsdWUuZm9yRWFjaCgodiwgaSkgPT4ge1xuICAgICAgYW5pbWF0aW9uW2ldID0gT2JqZWN0LmFzc2lnbih7fSwgYW5pbWF0aW9uQ29weSk7XG4gICAgICBhbmltYXRpb25baV0uY3VycmVudCA9IHY7XG4gICAgICBhbmltYXRpb25baV0udG9WYWx1ZSA9IChhbmltYXRpb24udG9WYWx1ZSBhcyBBcnJheTxudW1iZXI+KVtpXTtcbiAgICAgIGFuaW1hdGlvbltpXS5vblN0YXJ0KFxuICAgICAgICBhbmltYXRpb25baV0sXG4gICAgICAgIHYsXG4gICAgICAgIHRpbWVzdGFtcCxcbiAgICAgICAgcHJldmlvdXNBbmltYXRpb24gPyBwcmV2aW91c0FuaW1hdGlvbltpXSA6IHVuZGVmaW5lZFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGFuaW1hdGlvbi5jdXJyZW50ID0gdmFsdWU7XG4gIH07XG5cbiAgY29uc3QgYXJyYXlPbkZyYW1lID0gKFxuICAgIGFuaW1hdGlvbjogQW5pbWF0aW9uPEFuaW1hdGlvbk9iamVjdD4sXG4gICAgdGltZXN0YW1wOiBUaW1lc3RhbXBcbiAgKTogYm9vbGVhbiA9PiB7XG4gICAgbGV0IGZpbmlzaGVkID0gdHJ1ZTtcbiAgICAoYW5pbWF0aW9uLmN1cnJlbnQgYXMgQXJyYXk8bnVtYmVyPikuZm9yRWFjaCgoXywgaSkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYW5pbWF0aW9uW2ldLm9uRnJhbWUoYW5pbWF0aW9uW2ldLCB0aW1lc3RhbXApO1xuICAgICAgLy8gV2UgcmVhbGx5IG5lZWQgdG8gYXNzaWduIHRoaXMgdmFsdWUgdG8gcmVzdWx0LCBpbnN0ZWFkIG9mIHBhc3NpbmcgaXQgZGlyZWN0bHkgLSBvdGhlcndpc2Ugb25jZSBcImZpbmlzaGVkXCIgaXMgZmFsc2UsIG9uRnJhbWUgd29uJ3QgYmUgY2FsbGVkXG4gICAgICBmaW5pc2hlZCAmJj0gcmVzdWx0O1xuICAgICAgKGFuaW1hdGlvbi5jdXJyZW50IGFzIEFycmF5PG51bWJlcj4pW2ldID0gYW5pbWF0aW9uW2ldLmN1cnJlbnQ7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZmluaXNoZWQ7XG4gIH07XG5cbiAgY29uc3Qgb2JqZWN0T25TdGFydCA9IChcbiAgICBhbmltYXRpb246IEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+LFxuICAgIHZhbHVlOiBBbmltYXRhYmxlVmFsdWVPYmplY3QsXG4gICAgdGltZXN0YW1wOiBUaW1lc3RhbXAsXG4gICAgcHJldmlvdXNBbmltYXRpb246IEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+XG4gICk6IHZvaWQgPT4ge1xuICAgIGZvciAoY29uc3Qga2V5IGluIHZhbHVlKSB7XG4gICAgICBhbmltYXRpb25ba2V5XSA9IE9iamVjdC5hc3NpZ24oe30sIGFuaW1hdGlvbkNvcHkpO1xuICAgICAgYW5pbWF0aW9uW2tleV0ub25TdGFydCA9IGFuaW1hdGlvbi5vblN0YXJ0O1xuXG4gICAgICBhbmltYXRpb25ba2V5XS5jdXJyZW50ID0gdmFsdWVba2V5XTtcbiAgICAgIGFuaW1hdGlvbltrZXldLnRvVmFsdWUgPSAoYW5pbWF0aW9uLnRvVmFsdWUgYXMgQW5pbWF0YWJsZVZhbHVlT2JqZWN0KVtcbiAgICAgICAga2V5XG4gICAgICBdO1xuICAgICAgYW5pbWF0aW9uW2tleV0ub25TdGFydChcbiAgICAgICAgYW5pbWF0aW9uW2tleV0sXG4gICAgICAgIHZhbHVlW2tleV0sXG4gICAgICAgIHRpbWVzdGFtcCxcbiAgICAgICAgcHJldmlvdXNBbmltYXRpb24gPyBwcmV2aW91c0FuaW1hdGlvbltrZXldIDogdW5kZWZpbmVkXG4gICAgICApO1xuICAgIH1cbiAgICBhbmltYXRpb24uY3VycmVudCA9IHZhbHVlO1xuICB9O1xuXG4gIGNvbnN0IG9iamVjdE9uRnJhbWUgPSAoXG4gICAgYW5pbWF0aW9uOiBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PixcbiAgICB0aW1lc3RhbXA6IFRpbWVzdGFtcFxuICApOiBib29sZWFuID0+IHtcbiAgICBsZXQgZmluaXNoZWQgPSB0cnVlO1xuICAgIGNvbnN0IG5ld09iamVjdDogQW5pbWF0YWJsZVZhbHVlT2JqZWN0ID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gYW5pbWF0aW9uLmN1cnJlbnQgYXMgQW5pbWF0YWJsZVZhbHVlT2JqZWN0KSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhbmltYXRpb25ba2V5XS5vbkZyYW1lKGFuaW1hdGlvbltrZXldLCB0aW1lc3RhbXApO1xuICAgICAgLy8gV2UgcmVhbGx5IG5lZWQgdG8gYXNzaWduIHRoaXMgdmFsdWUgdG8gcmVzdWx0LCBpbnN0ZWFkIG9mIHBhc3NpbmcgaXQgZGlyZWN0bHkgLSBvdGhlcndpc2Ugb25jZSBcImZpbmlzaGVkXCIgaXMgZmFsc2UsIG9uRnJhbWUgd29uJ3QgYmUgY2FsbGVkXG4gICAgICBmaW5pc2hlZCAmJj0gcmVzdWx0O1xuICAgICAgbmV3T2JqZWN0W2tleV0gPSBhbmltYXRpb25ba2V5XS5jdXJyZW50O1xuICAgIH1cbiAgICBhbmltYXRpb24uY3VycmVudCA9IG5ld09iamVjdDtcbiAgICByZXR1cm4gZmluaXNoZWQ7XG4gIH07XG5cbiAgYW5pbWF0aW9uLm9uU3RhcnQgPSAoXG4gICAgYW5pbWF0aW9uOiBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PixcbiAgICB2YWx1ZTogbnVtYmVyLFxuICAgIHRpbWVzdGFtcDogVGltZXN0YW1wLFxuICAgIHByZXZpb3VzQW5pbWF0aW9uOiBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PlxuICApID0+IHtcbiAgICBpZiAoaXNDb2xvcih2YWx1ZSkpIHtcbiAgICAgIGNvbG9yT25TdGFydChhbmltYXRpb24sIHZhbHVlLCB0aW1lc3RhbXAsIHByZXZpb3VzQW5pbWF0aW9uKTtcbiAgICAgIGFuaW1hdGlvbi5vbkZyYW1lID0gY29sb3JPbkZyYW1lO1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoaXNBZmZpbmVNYXRyaXhGbGF0KHZhbHVlKSkge1xuICAgICAgdHJhbnNmb3JtYXRpb25NYXRyaXhPblN0YXJ0KFxuICAgICAgICBhbmltYXRpb24sXG4gICAgICAgIHZhbHVlLFxuICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgIHByZXZpb3VzQW5pbWF0aW9uXG4gICAgICApO1xuICAgICAgYW5pbWF0aW9uLm9uRnJhbWUgPSB0cmFuc2Zvcm1hdGlvbk1hdHJpeE9uRnJhbWU7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgYXJyYXlPblN0YXJ0KGFuaW1hdGlvbiwgdmFsdWUsIHRpbWVzdGFtcCwgcHJldmlvdXNBbmltYXRpb24pO1xuICAgICAgYW5pbWF0aW9uLm9uRnJhbWUgPSBhcnJheU9uRnJhbWU7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBwcmVmTnVtYmVyU3VmZk9uU3RhcnQoYW5pbWF0aW9uLCB2YWx1ZSwgdGltZXN0YW1wLCBwcmV2aW91c0FuaW1hdGlvbik7XG4gICAgICBhbmltYXRpb24ub25GcmFtZSA9IHByZWZOdW1iZXJTdWZmT25GcmFtZTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwpIHtcbiAgICAgIG9iamVjdE9uU3RhcnQoYW5pbWF0aW9uLCB2YWx1ZSwgdGltZXN0YW1wLCBwcmV2aW91c0FuaW1hdGlvbik7XG4gICAgICBhbmltYXRpb24ub25GcmFtZSA9IG9iamVjdE9uRnJhbWU7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGJhc2VPblN0YXJ0KGFuaW1hdGlvbiwgdmFsdWUsIHRpbWVzdGFtcCwgcHJldmlvdXNBbmltYXRpb24pO1xuICB9O1xufVxuXG50eXBlIEFuaW1hdGlvblRvRGVjb3JhdGlvbjxcbiAgVCBleHRlbmRzIEFuaW1hdGlvbk9iamVjdCB8IFN0eWxlTGF5b3V0QW5pbWF0aW9uLFxuICBVIGV4dGVuZHMgQW5pbWF0aW9uT2JqZWN0IHwgU3R5bGVMYXlvdXRBbmltYXRpb25cbj4gPSBUIGV4dGVuZHMgU3R5bGVMYXlvdXRBbmltYXRpb25cbiAgPyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuICA6IFUgfCAoKCkgPT4gVSkgfCBBbmltYXRhYmxlVmFsdWU7XG5cbmNvbnN0IElTX05BVElWRSA9IE5hdGl2ZVJlYW5pbWF0ZWRNb2R1bGUubmF0aXZlO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVmaW5lQW5pbWF0aW9uPFxuICBUIGV4dGVuZHMgQW5pbWF0aW9uT2JqZWN0IHwgU3R5bGVMYXlvdXRBbmltYXRpb24sIC8vIHR5cGUgdGhhdCdzIHN1cHBvc2VkIHRvIGJlIHJldHVybmVkXG4gIFUgZXh0ZW5kcyBBbmltYXRpb25PYmplY3QgfCBTdHlsZUxheW91dEFuaW1hdGlvbiA9IFQgLy8gdHlwZSB0aGF0J3MgcmVjZWl2ZWRcbj4oc3RhcnRpbmc6IEFuaW1hdGlvblRvRGVjb3JhdGlvbjxULCBVPiwgZmFjdG9yeTogKCkgPT4gVCk6IFQge1xuICAnd29ya2xldCc7XG4gIGlmIChJTl9TVFlMRV9VUERBVEVSKSB7XG4gICAgcmV0dXJuIHN0YXJ0aW5nIGFzIHVua25vd24gYXMgVDtcbiAgfVxuICBjb25zdCBjcmVhdGUgPSAoKSA9PiB7XG4gICAgJ3dvcmtsZXQnO1xuICAgIGNvbnN0IGFuaW1hdGlvbiA9IGZhY3RvcnkoKTtcbiAgICBkZWNvcmF0ZUFuaW1hdGlvbjxVPihhbmltYXRpb24gYXMgdW5rbm93biBhcyBVKTtcbiAgICByZXR1cm4gYW5pbWF0aW9uO1xuICB9O1xuXG4gIGlmIChfV09SS0xFVCB8fCAhSVNfTkFUSVZFKSB7XG4gICAgcmV0dXJuIGNyZWF0ZSgpO1xuICB9XG4gIC8vIEB0cy1pZ25vcmU6IGVzbGludC1kaXNhYmxlLWxpbmVcbiAgcmV0dXJuIGNyZWF0ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbmNlbEFuaW1hdGlvbjxUPihzaGFyZWRWYWx1ZTogU2hhcmVkVmFsdWU8VD4pOiB2b2lkIHtcbiAgJ3dvcmtsZXQnO1xuICAvLyBzZXR0aW5nIHRoZSBjdXJyZW50IHZhbHVlIGNhbmNlbHMgdGhlIGFuaW1hdGlvbiBpZiBvbmUgaXMgY3VycmVudGx5IHJ1bm5pbmdcbiAgc2hhcmVkVmFsdWUudmFsdWUgPSBzaGFyZWRWYWx1ZS52YWx1ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zZWxmLWFzc2lnblxufVxuXG4vLyBUT0RPIGl0IHNob3VsZCB3b3JrIG9ubHkgaWYgdGhlcmUgd2FzIG5vIGFuaW1hdGlvbiBiZWZvcmUuXG5leHBvcnQgZnVuY3Rpb24gd2l0aFN0YXJ0VmFsdWUoXG4gIHN0YXJ0VmFsdWU6IEFuaW1hdGFibGVWYWx1ZSxcbiAgYW5pbWF0aW9uOiBOZXh0QW5pbWF0aW9uPEFuaW1hdGlvbk9iamVjdD5cbik6IEFuaW1hdGlvbjxBbmltYXRpb25PYmplY3Q+IHtcbiAgJ3dvcmtsZXQnO1xuICByZXR1cm4gZGVmaW5lQW5pbWF0aW9uKHN0YXJ0VmFsdWUsICgpID0+IHtcbiAgICAnd29ya2xldCc7XG4gICAgaWYgKCFfV09SS0xFVCAmJiB0eXBlb2YgYW5pbWF0aW9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBhbmltYXRpb24gPSBhbmltYXRpb24oKTtcbiAgICB9XG4gICAgKGFuaW1hdGlvbiBhcyBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PikuY3VycmVudCA9IHN0YXJ0VmFsdWU7XG4gICAgcmV0dXJuIGFuaW1hdGlvbiBhcyBBbmltYXRpb248QW5pbWF0aW9uT2JqZWN0PjtcbiAgfSk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBTUEsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBaUJBLElBQUFDLGlCQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxZQUFBLEdBQUFILE9BQUE7QUFhQSxJQUFJSSxnQkFBZ0IsR0FBRyxLQUFLO0FBSXJCLFNBQVNDLGlCQUFpQkEsQ0FBSUMsT0FBZ0IsRUFBSztFQUN4REYsZ0JBQWdCLEdBQUcsSUFBSTtFQUN2QixJQUFNRyxNQUFNLEdBQUdELE9BQU8sRUFBRTtFQUN4QkYsZ0JBQWdCLEdBQUcsS0FBSztFQUN4QixPQUFPRyxNQUFNO0FBQ2Y7QUFRQSxTQUFTQyxxQkFBcUJBLENBQUNDLEtBQXNCLEVBQTBCO0VBQzdFLFNBQVM7O0VBQ1QsSUFBSSxPQUFPQSxLQUFLLEtBQUssUUFBUSxFQUFFO0lBQUEsSUFBQUMsT0FBQTtJQUM3QixJQUFNQyxLQUFLLEdBQUdGLEtBQUssQ0FBQ0UsS0FBSyxDQUN2Qix3REFBd0QsQ0FDekQ7SUFDRCxJQUFJLENBQUNBLEtBQUssRUFBRTtNQUNWLE1BQU1DLEtBQUssQ0FDVCxnRUFBZ0UsQ0FDakU7SUFDSDtJQUNBLElBQU1DLE1BQU0sR0FBR0YsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN2QixJQUFNRyxNQUFNLEdBQUdILEtBQUssQ0FBQyxDQUFDLENBQUM7SUFFdkIsSUFBTUksTUFBTSxHQUFHSixLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUFE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