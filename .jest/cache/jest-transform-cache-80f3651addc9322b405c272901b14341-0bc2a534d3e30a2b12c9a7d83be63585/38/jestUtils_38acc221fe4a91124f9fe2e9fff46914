ed32631ff7fe32ba5556d13a44f3e088
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.withReanimatedTimer = exports.setUpTests = exports.getAnimatedStyle = exports.advanceAnimationByTime = exports.advanceAnimationByFrame = void 0;
var _PlatformChecker = require("./PlatformChecker");
var config = {
  fps: 60
};
var isAnimatedStyle = function isAnimatedStyle(style) {
  return !!style.animatedStyle;
};
var getAnimatedStyleFromObject = function getAnimatedStyleFromObject(style) {
  return style.animatedStyle.current.value;
};
var getCurrentStyle = function getCurrentStyle(received) {
  var styleObject = received.props.style;
  var currentStyle = {};
  if (Array.isArray(styleObject)) {
    received.props.style.forEach(function (style) {
      if (isAnimatedStyle(style)) {
        currentStyle = Object.assign({}, currentStyle, getAnimatedStyleFromObject(style));
      } else {
        currentStyle = Object.assign({}, currentStyle, style);
      }
    });
  } else {
    if (isAnimatedStyle(styleObject)) {
      currentStyle = getAnimatedStyleFromObject(styleObject);
    } else {
      currentStyle = Object.assign({}, styleObject, received.props.animatedStyle.value);
    }
  }
  return currentStyle;
};
var checkEqual = function checkEqual(currentStyle, expectStyle) {
  if (Array.isArray(expectStyle)) {
    if (expectStyle.length !== currentStyle.length) return false;
    for (var i = 0; i < currentStyle.length; i++) {
      if (!checkEqual(currentStyle[i], expectStyle[i])) {
        return false;
      }
    }
  } else if (typeof currentStyle === 'object' && currentStyle) {
    for (var property in expectStyle) {
      if (!checkEqual(currentStyle[property], expectStyle[property])) {
        return false;
      }
    }
  } else {
    return currentStyle === expectStyle;
  }
  return true;
};
var findStyleDiff = function findStyleDiff(current, expect, shouldMatchAllProps) {
  var diffs = [];
  var isEqual = true;
  for (var property in expect) {
    if (!checkEqual(current[property], expect[property])) {
      isEqual = false;
      diffs.push({
        property: property,
        current: current[property],
        expect: expect[property]
      });
    }
  }
  if (shouldMatchAllProps && Object.keys(current).length !== Object.keys(expect).length) {
    isEqual = false;
    for (var _property in current) {
      if (expect[_property] === undefined) {
        diffs.push({
          property: _property,
          current: current[_property],
          expect: expect[_property]
        });
      }
    }
  }
  return {
    isEqual: isEqual,
    diffs: diffs
  };
};
var compareStyle = function compareStyle(received, expectedStyle, config) {
  if (!received.props.style) {
    return {
      message: function (_message) {
        function message() {
          return _message.apply(this, arguments);
        }
        message.toString = function () {
          return _message.toString();
        };
        return message;
      }(function () {
        return message;
      }),
      pass: false
    };
  }
  var shouldMatchAllProps = config.shouldMatchAllProps;
  var currentStyle = getCurrentStyle(received);
  var _findStyleDiff = findStyleDiff(currentStyle, expectedStyle, shouldMatchAllProps),
    isEqual = _findStyleDiff.isEqual,
    diffs = _findStyleDiff.diffs;
  if (isEqual) {
    return {
      message: function message() {
        return 'ok';
      },
      pass: true
    };
  }
  var currentStyleStr = JSON.stringify(currentStyle);
  var expectedStyleStr = JSON.stringify(expectedStyle);
  var differences = diffs.map(function (diff) {
    return `- '${diff.property}' should be ${JSON.stringify(diff.expect)}, but is ${JSON.stringify(diff.current)}`;
  }).join('\n');
  return {
    message: function message() {
      return `Expected: ${expectedStyleStr}\nReceived: ${currentStyleStr}\n\nDifferences:\n${differences}`;
    },
    pass: false
  };
};
var frameTime = 1000 / config.fps;
var beforeTest = function beforeTest() {
  jest.useFakeTimers();
};
var afterTest = function afterTest() {
  jest.runOnlyPendingTimers();
  jest.useRealTimers();
};
var withReanimatedTimer = function withReanimatedTimer(animationTest) {
  console.warn('This method is deprecated, you should define your own before and after test hooks to enable jest.useFakeTimers(). Check out the documentation for details on testing');
  beforeTest();
  animationTest();
  afterTest();
};
exports.withReanimatedTimer = withReanimatedTimer;
var advanceAnimationByTime = function advanceAnimationByTime() {
  var time = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : frameTime;
  console.warn('This method is deprecated, use jest.advanceTimersByTime directly');
  jest.advanceTimersByTime(time);
  jest.runOnlyPendingTimers();
};
exports.advanceAnimationByTime = advanceAnimationByTime;
var advanceAnimationByFrame = function advanceAnimationByFrame(count) {
  console.warn('This method is deprecated, use jest.advanceTimersByTime directly');
  jest.advanceTimersByTime(count * frameTime);
  jest.runOnlyPendingTimers();
};
exports.advanceAnimationByFrame = advanceAnimationByFrame;
var requireFunction = (0, _PlatformChecker.isJest)() ? require : function () {
  throw new Error('[Reanimated] setUpTests() is available only in Jest environment');
};
var setUpTests = function setUpTests() {
  var userConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var expect = global.expect;
  if (expect === undefined) {
    var expectModule = requireFunction('expect');
    expect = expectModule;
    if (typeof expect === 'object') {
      var jestGlobals = requireFunction('@jest/globals');
      expect = jestGlobals.expect;
    }
    if (expect === undefined || expect.extend === undefined) {
      expect = expectModule.default;
    }
  }
  frameTime = Math.round(1000 / config.fps);
  config = Object.assign({}, config, userConfig);
  expect.extend({
    toHaveAnimatedStyle: function toHaveAnimatedStyle(received, expectedStyle) {
      var config = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      return compareStyle(received, expectedStyle, config);
    }
  });
};
exports.setUpTests = setUpTests;
var getAnimatedStyle = function getAnimatedStyle(received) {
  return getCurrentStyle(received);
};
exports.getAnimatedStyle = getAnimatedStyle;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfUGxhdGZvcm1DaGVja2VyIiwicmVxdWlyZSIsImNvbmZpZyIsImZwcyIsImlzQW5pbWF0ZWRTdHlsZSIsInN0eWxlIiwiYW5pbWF0ZWRTdHlsZSIsImdldEFuaW1hdGVkU3R5bGVGcm9tT2JqZWN0IiwiY3VycmVudCIsInZhbHVlIiwiZ2V0Q3VycmVudFN0eWxlIiwicmVjZWl2ZWQiLCJzdHlsZU9iamVjdCIsInByb3BzIiwiY3VycmVudFN0eWxlIiwiQXJyYXkiLCJpc0FycmF5IiwiZm9yRWFjaCIsIk9iamVjdCIsImFzc2lnbiIsImNoZWNrRXF1YWwiLCJleHBlY3RTdHlsZSIsImxlbmd0aCIsImkiLCJwcm9wZXJ0eSIsImZpbmRTdHlsZURpZmYiLCJleHBlY3QiLCJzaG91bGRNYXRjaEFsbFByb3BzIiwiZGlmZnMiLCJpc0VxdWFsIiwicHVzaCIsImtleXMiLCJ1bmRlZmluZWQiLCJjb21wYXJlU3R5bGUiLCJleHBlY3RlZFN0eWxlIiwibWVzc2FnZSIsIl9tZXNzYWdlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJ0b1N0cmluZyIsInBhc3MiLCJfZmluZFN0eWxlRGlmZiIsImN1cnJlbnRTdHlsZVN0ciIsIkpTT04iLCJzdHJpbmdpZnkiLCJleHBlY3RlZFN0eWxlU3RyIiwiZGlmZmVyZW5jZXMiLCJtYXAiLCJkaWZmIiwiam9pbiIsImZyYW1lVGltZSIsImJlZm9yZVRlc3QiLCJqZXN0IiwidXNlRmFrZVRpbWVycyIsImFmdGVyVGVzdCIsInJ1bk9ubHlQZW5kaW5nVGltZXJzIiwidXNlUmVhbFRpbWVycyIsIndpdGhSZWFuaW1hdGVkVGltZXIiLCJhbmltYXRpb25UZXN0IiwiY29uc29sZSIsIndhcm4iLCJleHBvcnRzIiwiYWR2YW5jZUFuaW1hdGlvbkJ5VGltZSIsInRpbWUiLCJhZHZhbmNlVGltZXJzQnlUaW1lIiwiYWR2YW5jZUFuaW1hdGlvbkJ5RnJhbWUiLCJjb3VudCIsInJlcXVpcmVGdW5jdGlvbiIsImlzSmVzdCIsIkVycm9yIiwic2V0VXBUZXN0cyIsInVzZXJDb25maWciLCJnbG9iYWwiLCJleHBlY3RNb2R1bGUiLCJqZXN0R2xvYmFscyIsImV4dGVuZCIsImRlZmF1bHQiLCJNYXRoIiwicm91bmQiLCJ0b0hhdmVBbmltYXRlZFN0eWxlIiwiZ2V0QW5pbWF0ZWRTdHlsZSJdLCJzb3VyY2VzIjpbImplc3RVdGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10cy1jb21tZW50XG4vLyBAdHMtbm9jaGVja1xuXG5pbXBvcnQgeyBpc0plc3QgfSBmcm9tICcuL1BsYXRmb3JtQ2hlY2tlcic7XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1uYW1lc3BhY2VcbiAgbmFtZXNwYWNlIGplc3Qge1xuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XG4gICAgICB0b0hhdmVBbmltYXRlZFN0eWxlKFxuICAgICAgICBzdHlsZTogUmVjb3JkPHN0cmluZywgdW5rbm93bj5bXSB8IFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgICAgICBjb25maWc/OiB7XG4gICAgICAgICAgc2hvdWxkTWF0Y2hBbGxQcm9wcz86IGJvb2xlYW47XG4gICAgICAgIH1cbiAgICAgICk6IFI7XG4gICAgfVxuICB9XG59XG5cbmxldCBjb25maWcgPSB7XG4gIGZwczogNjAsXG59O1xuXG5jb25zdCBpc0FuaW1hdGVkU3R5bGUgPSAoc3R5bGUpID0+IHtcbiAgcmV0dXJuICEhc3R5bGUuYW5pbWF0ZWRTdHlsZTtcbn07XG5cbmNvbnN0IGdldEFuaW1hdGVkU3R5bGVGcm9tT2JqZWN0ID0gKHN0eWxlKSA9PiB7XG4gIHJldHVybiBzdHlsZS5hbmltYXRlZFN0eWxlLmN1cnJlbnQudmFsdWU7XG59O1xuXG5jb25zdCBnZXRDdXJyZW50U3R5bGUgPSAocmVjZWl2ZWQpOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0+IHtcbiAgY29uc3Qgc3R5bGVPYmplY3QgPSByZWNlaXZlZC5wcm9wcy5zdHlsZTtcbiAgbGV0IGN1cnJlbnRTdHlsZSA9IHt9O1xuICBpZiAoQXJyYXkuaXNBcnJheShzdHlsZU9iamVjdCkpIHtcbiAgICByZWNlaXZlZC5wcm9wcy5zdHlsZS5mb3JFYWNoKChzdHlsZSkgPT4ge1xuICAgICAgaWYgKGlzQW5pbWF0ZWRTdHlsZShzdHlsZSkpIHtcbiAgICAgICAgY3VycmVudFN0eWxlID0ge1xuICAgICAgICAgIC4uLmN1cnJlbnRTdHlsZSxcbiAgICAgICAgICAuLi5nZXRBbmltYXRlZFN0eWxlRnJvbU9iamVjdChzdHlsZSksXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50U3R5bGUgPSB7XG4gICAgICAgICAgLi4uY3VycmVudFN0eWxlLFxuICAgICAgICAgIC4uLnN0eWxlLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGlmIChpc0FuaW1hdGVkU3R5bGUoc3R5bGVPYmplY3QpKSB7XG4gICAgICBjdXJyZW50U3R5bGUgPSBnZXRBbmltYXRlZFN0eWxlRnJvbU9iamVjdChzdHlsZU9iamVjdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN1cnJlbnRTdHlsZSA9IHtcbiAgICAgICAgLi4uc3R5bGVPYmplY3QsXG4gICAgICAgIC4uLnJlY2VpdmVkLnByb3BzLmFuaW1hdGVkU3R5bGUudmFsdWUsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICByZXR1cm4gY3VycmVudFN0eWxlO1xufTtcblxuY29uc3QgY2hlY2tFcXVhbCA9IChjdXJyZW50U3R5bGUsIGV4cGVjdFN0eWxlKSA9PiB7XG4gIGlmIChBcnJheS5pc0FycmF5KGV4cGVjdFN0eWxlKSkge1xuICAgIGlmIChleHBlY3RTdHlsZS5sZW5ndGggIT09IGN1cnJlbnRTdHlsZS5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1cnJlbnRTdHlsZS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFjaGVja0VxdWFsKGN1cnJlbnRTdHlsZVtpXSwgZXhwZWN0U3R5bGVbaV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIGN1cnJlbnRTdHlsZSA9PT0gJ29iamVjdCcgJiYgY3VycmVudFN0eWxlKSB7XG4gICAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBleHBlY3RTdHlsZSkge1xuICAgICAgaWYgKCFjaGVja0VxdWFsKGN1cnJlbnRTdHlsZVtwcm9wZXJ0eV0sIGV4cGVjdFN0eWxlW3Byb3BlcnR5XSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY3VycmVudFN0eWxlID09PSBleHBlY3RTdHlsZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmNvbnN0IGZpbmRTdHlsZURpZmYgPSAoY3VycmVudCwgZXhwZWN0LCBzaG91bGRNYXRjaEFsbFByb3BzKSA9PiB7XG4gIGNvbnN0IGRpZmZzID0gW107XG4gIGxldCBpc0VxdWFsID0gdHJ1ZTtcbiAgZm9yIChjb25zdCBwcm9wZXJ0eSBpbiBleHBlY3QpIHtcbiAgICBpZiAoIWNoZWNrRXF1YWwoY3VycmVudFtwcm9wZXJ0eV0sIGV4cGVjdFtwcm9wZXJ0eV0pKSB7XG4gICAgICBpc0VxdWFsID0gZmFsc2U7XG4gICAgICBkaWZmcy5wdXNoKHtcbiAgICAgICAgcHJvcGVydHk6IHByb3BlcnR5LFxuICAgICAgICBjdXJyZW50OiBjdXJyZW50W3Byb3BlcnR5XSxcbiAgICAgICAgZXhwZWN0OiBleHBlY3RbcHJvcGVydHldLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKFxuICAgIHNob3VsZE1hdGNoQWxsUHJvcHMgJiZcbiAgICBPYmplY3Qua2V5cyhjdXJyZW50KS5sZW5ndGggIT09IE9iamVjdC5rZXlzKGV4cGVjdCkubGVuZ3RoXG4gICkge1xuICAgIGlzRXF1YWwgPSBmYWxzZTtcbiAgICBmb3IgKGNvbnN0IHByb3BlcnR5IGluIGN1cnJlbnQpIHtcbiAgICAgIGlmIChleHBlY3RbcHJvcGVydHldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZGlmZnMucHVzaCh7XG4gICAgICAgICAgcHJvcGVydHk6IHByb3BlcnR5LFxuICAgICAgICAgIGN1cnJlbnQ6IGN1cnJlbnRbcHJvcGVydHldLFxuICAgICAgICAgIGV4cGVjdDogZXhwZWN0W3Byb3BlcnR5XSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgaXNFcXVhbCwgZGlmZnMgfTtcbn07XG5cbmNvbnN0IGNvbXBhcmVTdHlsZSA9IChyZWNlaXZlZCwgZXhwZWN0ZWRTdHlsZSwgY29uZmlnKSA9PiB7XG4gIGlmICghcmVjZWl2ZWQucHJvcHMuc3R5bGUpIHtcbiAgICByZXR1cm4geyBtZXNzYWdlOiAoKSA9PiBtZXNzYWdlLCBwYXNzOiBmYWxzZSB9O1xuICB9XG4gIGNvbnN0IHsgc2hvdWxkTWF0Y2hBbGxQcm9wcyB9ID0gY29uZmlnO1xuICBjb25zdCBjdXJyZW50U3R5bGUgPSBnZXRDdXJyZW50U3R5bGUocmVjZWl2ZWQpO1xuICBjb25zdCB7IGlzRXF1YWwsIGRpZmZzIH0gPSBmaW5kU3R5bGVEaWZmKFxuICAgIGN1cnJlbnRTdHlsZSxcbiAgICBleHBlY3RlZFN0eWxlLFxuICAgIHNob3VsZE1hdGNoQWxsUHJvcHNcbiAgKTtcblxuICBpZiAoaXNFcXVhbCkge1xuICAgIHJldHVybiB7IG1lc3NhZ2U6ICgpID0+ICdvaycsIHBhc3M6IHRydWUgfTtcbiAgfVxuXG4gIGNvbnN0IGN1cnJlbnRTdHlsZVN0ciA9IEpTT04uc3RyaW5naWZ5KGN1cnJlbnRTdHlsZSk7XG4gIGNvbnN0IGV4cGVjdGVkU3R5bGVTdHIgPSBKU09OLnN0cmluZ2lmeShleHBlY3RlZFN0eWxlKTtcbiAgY29uc3QgZGlmZmVyZW5jZXMgPSBkaWZmc1xuICAgIC5tYXAoXG4gICAgICAoZGlmZikgPT5cbiAgICAgICAgYC0gJyR7ZGlmZi5wcm9wZXJ0eX0nIHNob3VsZCBiZSAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICAgIGRpZmYuZXhwZWN0XG4gICAgICAgICl9LCBidXQgaXMgJHtKU09OLnN0cmluZ2lmeShkaWZmLmN1cnJlbnQpfWBcbiAgICApXG4gICAgLmpvaW4oJ1xcbicpO1xuXG4gIHJldHVybiB7XG4gICAgbWVzc2FnZTogKCkgPT5cbiAgICAgIGBFeHBlY3RlZDogJHtleHBlY3RlZFN0eWxlU3RyfVxcblJlY2VpdmVkOiAke2N1cnJlbnRTdHlsZVN0cn1cXG5cXG5EaWZmZXJlbmNlczpcXG4ke2RpZmZlcmVuY2VzfWAsXG4gICAgcGFzczogZmFsc2UsXG4gIH07XG59O1xuXG5sZXQgZnJhbWVUaW1lID0gMTAwMCAvIGNvbmZpZy5mcHM7XG5cbmNvbnN0IGJlZm9yZVRlc3QgPSAoKSA9PiB7XG4gIGplc3QudXNlRmFrZVRpbWVycygpO1xufTtcblxuY29uc3QgYWZ0ZXJUZXN0ID0gKCkgPT4ge1xuICBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzKCk7XG4gIGplc3QudXNlUmVhbFRpbWVycygpO1xufTtcblxuZXhwb3J0IGNvbnN0IHdpdGhSZWFuaW1hdGVkVGltZXIgPSAoYW5pbWF0aW9uVGVzdCkgPT4ge1xuICBjb25zb2xlLndhcm4oXG4gICAgJ1RoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQsIHlvdSBzaG91bGQgZGVmaW5lIHlvdXIgb3duIGJlZm9yZSBhbmQgYWZ0ZXIgdGVzdCBob29rcyB0byBlbmFibGUgamVzdC51c2VGYWtlVGltZXJzKCkuIENoZWNrIG91dCB0aGUgZG9jdW1lbnRhdGlvbiBmb3IgZGV0YWlscyBvbiB0ZXN0aW5nJ1xuICApO1xuICBiZWZvcmVUZXN0KCk7XG4gIGFuaW1hdGlvblRlc3QoKTtcbiAgYWZ0ZXJUZXN0KCk7XG59O1xuXG5leHBvcnQgY29uc3QgYWR2YW5jZUFuaW1hdGlvbkJ5VGltZSA9ICh0aW1lID0gZnJhbWVUaW1lKSA9PiB7XG4gIGNvbnNvbGUud2FybihcbiAgICAnVGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZCwgdXNlIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSBkaXJlY3RseSdcbiAgKTtcbiAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKHRpbWUpO1xuICBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzKCk7XG59O1xuXG5leHBvcnQgY29uc3QgYWR2YW5jZUFuaW1hdGlvbkJ5RnJhbWUgPSAoY291bnQpID0+IHtcbiAgY29uc29sZS53YXJuKFxuICAgICdUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkLCB1c2UgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lIGRpcmVjdGx5J1xuICApO1xuICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoY291bnQgKiBmcmFtZVRpbWUpO1xuICBqZXN0LnJ1bk9ubHlQZW5kaW5nVGltZXJzKCk7XG59O1xuXG5jb25zdCByZXF1aXJlRnVuY3Rpb24gPSBpc0plc3QoKVxuICA/IHJlcXVpcmVcbiAgOiAoKSA9PiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICdbUmVhbmltYXRlZF0gc2V0VXBUZXN0cygpIGlzIGF2YWlsYWJsZSBvbmx5IGluIEplc3QgZW52aXJvbm1lbnQnXG4gICAgICApO1xuICAgIH07XG5cbmV4cG9ydCBjb25zdCBzZXRVcFRlc3RzID0gKHVzZXJDb25maWcgPSB7fSkgPT4ge1xuICBsZXQgZXhwZWN0ID0gZ2xvYmFsLmV4cGVjdDtcbiAgaWYgKGV4cGVjdCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgY29uc3QgZXhwZWN0TW9kdWxlID0gcmVxdWlyZUZ1bmN0aW9uKCdleHBlY3QnKTtcbiAgICBleHBlY3QgPSBleHBlY3RNb2R1bGU7XG4gICAgLy8gU3RhcnRpbmcgZnJvbSBKZXN0IDI4LCBcImV4cGVjdFwiIHBhY2thZ2UgdXNlcyBuYW1lZCBleHBvcnRzIGluc3RlYWQgb2YgZGVmYXVsdCBleHBvcnQuXG4gICAgLy8gU28sIHJlcXVpcmluZyBcImV4cGVjdFwiIHBhY2thZ2UgZG9lc24ndCBnaXZlIGRpcmVjdCBhY2Nlc3MgdG8gXCJleHBlY3RcIiBmdW5jdGlvbiBhbnltb3JlLlxuICAgIC8vIEl0IGdpdmVzIGFjY2VzcyB0byB0aGUgbW9kdWxlIG9iamVjdCBpbnN0ZWFkLlxuICAgIC8vIFdlIHVzZSB0aGlzIGluZm8gdG8gZGV0ZWN0IGlmIHRoZSBwcm9qZWN0IHVzZXMgSmVzdCAyOCBvciBoaWdoZXIuXG4gICAgaWYgKHR5cGVvZiBleHBlY3QgPT09ICdvYmplY3QnKSB7XG4gICAgICBjb25zdCBqZXN0R2xvYmFscyA9IHJlcXVpcmVGdW5jdGlvbignQGplc3QvZ2xvYmFscycpO1xuICAgICAgZXhwZWN0ID0gamVzdEdsb2JhbHMuZXhwZWN0O1xuICAgIH1cbiAgICBpZiAoZXhwZWN0ID09PSB1bmRlZmluZWQgfHwgZXhwZWN0LmV4dGVuZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBleHBlY3QgPSBleHBlY3RNb2R1bGUuZGVmYXVsdDtcbiAgICB9XG4gIH1cblxuICBmcmFtZVRpbWUgPSBNYXRoLnJvdW5kKDEwMDAgLyBjb25maWcuZnBzKTtcblxuICBjb25maWcgPSB7XG4gICAgLi4uY29uZmlnLFxuICAgIC4uLnVzZXJDb25maWcsXG4gIH07XG4gIGV4cGVjdC5leHRlbmQoe1xuICAgIHRvSGF2ZUFuaW1hdGVkU3R5bGUocmVjZWl2ZWQsIGV4cGVjdGVkU3R5bGUsIGNvbmZpZyA9IHt9KSB7XG4gICAgICByZXR1cm4gY29tcGFyZVN0eWxlKHJlY2VpdmVkLCBleHBlY3RlZFN0eWxlLCBjb25maWcpO1xuICAgIH0sXG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEFuaW1hdGVkU3R5bGUgPSAocmVjZWl2ZWQpID0+IHtcbiAgcmV0dXJuIGdldEN1cnJlbnRTdHlsZShyZWNlaXZlZCk7XG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7O0FBR0EsSUFBQUEsZ0JBQUEsR0FBQUMsT0FBQTtBQWdCQSxJQUFJQyxNQUFN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